(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{162:function(s,t,e){"use strict";e.r(t);var a=e(0),n=Object(a.a)({},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"content"},[s._m(0),e("p",[s._v('A session is a way of storing values across multiple requests from the same\nuser. Carolina comes with several options for a "Session" service.')]),s._m(1),s._m(2),s._m(3),s._m(4),s._m(5),s._m(6),s._m(7),s._m(8),s._m(9),s._m(10),e("p",[s._v("Here is an example method in a route controller:")]),s._m(11),s._m(12),s._m(13),s._m(14),s._m(15),s._m(16),e("p",[s._v("In setting session values, you should avoid the following values which\nare used by various parts of the Carolina framework:")]),s._m(17),s._m(18),s._m(19),e("p",[s._v("Flash messages are useful for carrying information through following a\nredirect.")]),s._m(20),s._m(21),s._m(22),e("p",[s._v('Suppose that after the above redirect, the controller for "/other-page"\nreturned the template below:')]),s._m(23),e("p",[s._v("In that case, the relevant generated HTML would be this:")]),s._m(24),e("p",[s._v("You are free of course to make your own mixins to work better with frameworks\nother than bootstrap.")]),s._m(25),e("p",[s._v("For information on writing your own implementation of the Session Service\nto work with the Carolina framework, see the\n"),e("router-link",{attrs:{to:"/customservices/session.html"}},[s._v("Custom Session Service")]),s._v(" page.")],1)])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"session"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session","aria-hidden":"true"}},[this._v("#")]),this._v(" Session")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"session-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Session Configuration")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("The following Session Service implementations are included with Carolina.\nSpecify the path to the one\nyou want to use in "),t("code",[this._v("config/app.js")]),this._v(".")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("table",[e("thead",[e("tr",[e("th",[s._v("Class Name")]),e("th",[s._v("Path")]),e("th",[s._v("Description")])])]),e("tbody",[e("tr",[e("td",[e("strong",[e("code",[s._v("DbSessionService")])])]),e("td",[e("code",[s._v("carolina/services/session/db-session")])]),e("td",[s._v("Stores session data in the database using the built-in "),e("code",[s._v("SessionInfo")]),s._v(" model. This is the default for new projects.")])]),e("tr",[e("td",[e("code",[s._v("InMemorySessionService")])]),e("td",[e("code",[s._v("carolina/services/session/in-memory-session")])]),e("td",[s._v("Stores session data as an object in memory. Does not persist and should only be used in development.")])]),e("tr",[e("td",[e("code",[s._v("JsonFilesSessionService")])]),e("td",[e("code",[s._v("carolina/services/session/json-files-session")])]),e("td",[s._v("Subclass of "),e("code",[s._v("InMemorySessionService")]),s._v(", but saves session data to local files during "),e("code",[s._v("onShutdown()")]),s._v(".")])]),e("tr",[e("td",[e("code",[s._v("NodeCacheSessionService")])]),e("td",[e("code",[s._v("carolina/services/session/node-cache-session")])]),e("td",[s._v("Stores session data using the NPM module "),e("code",[s._v("node-cache")]),s._v(". Does not persist.")])]),e("tr",[e("td",[e("code",[s._v("RedisSessionService")])]),e("td",[e("code",[s._v("carolina/services/session/redis-session")])]),e("td",[s._v("Stores session data in a redis server. Works with AWS ElastiCache.")])])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"session-service-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session-service-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Session Service Configuration")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("The Session Service to use is specified in "),t("code",[this._v("config/app.js")]),this._v(".\nConfiguration for the Session Service is located in "),t("code",[this._v("config/session.js")]),this._v(".")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("If you are using "),t("code",[this._v("JsonFilesSessionService")]),this._v(", you will need to have\nthe "),t("code",[this._v("sessionFilesDir")]),this._v(" attribute point to a folder where you want JSON files\nbe stored. By default, it points to "),t("code",[this._v("storage/session/")]),this._v(" which is also\ngit-ignored by default.")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("p",[s._v("If you are using "),e("code",[s._v("RedisSessionService")]),s._v(", you will need to have a Redis server\nset up. The "),e("code",[s._v("RedisSessionService")]),s._v(" works well with AWS ElastiCache Redis\nservers, provided you set up the security and permissions.\nTo use "),e("code",[s._v("RedisSessionService")]),s._v(", you will need to configure the "),e("code",[s._v("redisHost")]),s._v(" and\n"),e("code",[s._v("redisPort")]),s._v(' attributes. By default, they look for "REDIS_HOST"\nand "REDIS_PORT" in your '),e("code",[s._v(".env")]),s._v(' file and fall back, respectively, to\n"localhost" and "6397".')])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"using-session-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-session-data","aria-hidden":"true"}},[this._v("#")]),this._v(" Using Session Data")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"accessing-session-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#accessing-session-data","aria-hidden":"true"}},[this._v("#")]),this._v(" Accessing Session Data")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("p",[s._v('By default, all incoming requests to the "browser" middleware group go through\nthe '),e("code",[s._v("SessionMiddleware")]),s._v(" middleware (this is specified in "),e("code",[s._v("config/http.js")]),s._v(").\nIn that case, if session ID is found in the cookies of an incoming request,\nand that session ID matches a valid session, the sesson data will be available\nas "),e("code",[s._v("request.session")]),s._v(". In all other cases (including when the middleware\nis not used at all), "),e("code",[s._v("request.session")]),s._v(" will be an empty object.")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// get the key out of the session if it exists.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" specialKey "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("specialKey "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// do something with the special key")]),s._v("\n  \n  console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// => { specialKey: 1, csrf_token: "some_token", etc... }')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"setting-session-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-session-data","aria-hidden":"true"}},[this._v("#")]),this._v(" Setting Session Data")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("When you create an "),t("code",[this._v("HttpResponse")]),this._v(" object, it will have an empty object as\n"),t("code",[this._v("response.session")]),this._v(". You can add any JSON-stringifiable data to it.")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("If the route is using "),t("code",[this._v("SessionMiddleware")]),this._v(", then the pre-existing session\nfrom the request will be updated with the "),t("code",[this._v("response.session")]),this._v(" (overwriting\nany existing keys) and saved with the "),t("code",[this._v("SessionService")]),this._v(" (and made available\nin the next request).")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" response "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendText")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello, World!"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("specialKey "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("DANGER")]),t("p",[this._v("Be careful about what you assign to "),t("code",[this._v("response.session")]),this._v(". Some implementations\nof the Session Service need to call "),t("code",[this._v("JSON.stringify")]),this._v(" against the session\nobject. It is safest to stick to basic types (strings, numbers, arrays, objects)\nand avoid insantiated classes or circular references.")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("code",[this._v("csrf_token")])]),t("li",[t("code",[this._v("flash_messages")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"flash-messages"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flash-messages","aria-hidden":"true"}},[this._v("#")]),this._v(" Flash Messages")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Flash Messages are special messages that will appear only on the next\nrequest (to anywhere on your site that uses "),t("code",[this._v("SessionMiddleware")]),this._v(").\nFlash message objects are stored in the session as "),t("code",[this._v("flash_messages")]),this._v(", and\nold ones are automatically deleted.")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("The easiest way to use flash messages is to use the\n"),t("code",[this._v("response.flash(message, title, severity)")]),this._v(" method.")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" response "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("redirect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/other-page"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("flash")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"You were redirected."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Attention!"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("flash")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Your last operation was successful."')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v('Note that the default title is null and the default severity is "primary".\nYou can access this data in your pug templates as\n'),t("code",[this._v("request.session.flash_messages")]),this._v(", but there is a built-in mixin\nprovided in "),t("code",[this._v("templates/carolina/session/mixins.pug")]),this._v(".")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-pug extra-class"},[e("pre",{pre:!0,attrs:{class:"language-pug"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends carolina/base/bootstrap_base")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include carolina/session/mixins")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("block body")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token tag"}},[s._v("div.container")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token mixin"}},[e("span",{pre:!0,attrs:{class:"token name function"}},[s._v("+flashMessages")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("locals"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])]),s._v("\n")])])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("class")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("alert alert-primary"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("b")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Attention!"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("b")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  You were redirected.\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("class")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("alert alert-success"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  Your last operation was successful.\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"custom-session-service-implementation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#custom-session-service-implementation","aria-hidden":"true"}},[this._v("#")]),this._v(" Custom Session Service Implementation")])}],!1,null,null,null);t.default=n.exports}}]);