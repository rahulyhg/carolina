<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Session | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.1d2d3735.css" as="style"><link rel="preload" href="/assets/js/app.1d2d3735.js" as="script"><link rel="preload" href="/assets/js/24.0bac6e09.js" as="script"><link rel="prefetch" href="/assets/js/1.f05c9cba.js"><link rel="prefetch" href="/assets/js/10.bac22d9b.js"><link rel="prefetch" href="/assets/js/11.3d8fb5fe.js"><link rel="prefetch" href="/assets/js/12.15d64a99.js"><link rel="prefetch" href="/assets/js/13.025e71f2.js"><link rel="prefetch" href="/assets/js/14.fd7a08c1.js"><link rel="prefetch" href="/assets/js/15.e1bc1756.js"><link rel="prefetch" href="/assets/js/16.5770cf46.js"><link rel="prefetch" href="/assets/js/17.853ce496.js"><link rel="prefetch" href="/assets/js/18.971e2150.js"><link rel="prefetch" href="/assets/js/19.c761800c.js"><link rel="prefetch" href="/assets/js/2.988f372d.js"><link rel="prefetch" href="/assets/js/20.4e4bef1c.js"><link rel="prefetch" href="/assets/js/21.b3aaaedf.js"><link rel="prefetch" href="/assets/js/22.1bb76f3c.js"><link rel="prefetch" href="/assets/js/23.3d27ba26.js"><link rel="prefetch" href="/assets/js/25.c2b28b9a.js"><link rel="prefetch" href="/assets/js/26.0d288857.js"><link rel="prefetch" href="/assets/js/27.98f9eff3.js"><link rel="prefetch" href="/assets/js/28.26974ced.js"><link rel="prefetch" href="/assets/js/29.6b34c182.js"><link rel="prefetch" href="/assets/js/3.8f49772c.js"><link rel="prefetch" href="/assets/js/30.3e9f8855.js"><link rel="prefetch" href="/assets/js/31.f88a0e4e.js"><link rel="prefetch" href="/assets/js/32.cd87dfeb.js"><link rel="prefetch" href="/assets/js/33.b61fa559.js"><link rel="prefetch" href="/assets/js/34.c116294f.js"><link rel="prefetch" href="/assets/js/35.2f210b65.js"><link rel="prefetch" href="/assets/js/36.cb8e5677.js"><link rel="prefetch" href="/assets/js/37.0de8ac6f.js"><link rel="prefetch" href="/assets/js/38.cb46e1ce.js"><link rel="prefetch" href="/assets/js/39.b4986129.js"><link rel="prefetch" href="/assets/js/4.6855463a.js"><link rel="prefetch" href="/assets/js/40.a060c3fb.js"><link rel="prefetch" href="/assets/js/41.e48da89d.js"><link rel="prefetch" href="/assets/js/42.3cf3cf2d.js"><link rel="prefetch" href="/assets/js/43.74393af5.js"><link rel="prefetch" href="/assets/js/44.9d05ba51.js"><link rel="prefetch" href="/assets/js/5.00dd7cd0.js"><link rel="prefetch" href="/assets/js/6.9ca81a96.js"><link rel="prefetch" href="/assets/js/7.24dcfe4e.js"><link rel="prefetch" href="/assets/js/8.f67b2fab.js"><link rel="prefetch" href="/assets/js/9.85b5be06.js">
    <link rel="stylesheet" href="/assets/css/styles.1d2d3735.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Framework Overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Basics</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/docs/basics/routing.html" class="sidebar-link">Routing</a></li><li><a href="/docs/basics/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/docs/basics/csrf.html" class="sidebar-link">CSRF Tokens </a></li><li><a href="/docs/basics/controllers.html" class="sidebar-link">Controller Classes</a></li><li><a href="/docs/basics/requests.html" class="sidebar-link">HTTP Request Objects</a></li><li><a href="/docs/basics/responses.html" class="sidebar-link">HTTP Response Objects</a></li><li><a href="/docs/basics/template-views.html" class="sidebar-link">Template Views</a></li><li><a href="/docs/basics/session.html" class="active sidebar-link">Session</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/basics/session.html#session-configuration" class="sidebar-link">Session Configuration</a></li><li class="sidebar-sub-header"><a href="/docs/basics/session.html#session-service-configuration" class="sidebar-link">Session Service Configuration</a></li><li class="sidebar-sub-header"><a href="/docs/basics/session.html#using-session-data" class="sidebar-link">Using Session Data</a></li><li class="sidebar-sub-header"><a href="/docs/basics/session.html#flash-messages" class="sidebar-link">Flash Messages</a></li><li class="sidebar-sub-header"><a href="/docs/basics/session.html#custom-session-service-implementation" class="sidebar-link">Custom Session Service Implementation</a></li></ul></li><li><a href="/docs/basics/validation.html" class="sidebar-link">Validation</a></li><li><a href="/docs/basics/errors.html" class="sidebar-link">Exceptions</a></li><li><a href="/docs/basics/logging.html" class="sidebar-link">Logging</a></li><li><a href="/docs/basics/pug.html" class="sidebar-link">Pug Templates</a></li><li><a href="/docs/basics/crypto.html" class="sidebar-link">The Crypto Service</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Advanced</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Databases</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Included Plugins</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="session"><a href="#session" aria-hidden="true" class="header-anchor">#</a> Session</h1><p>A session is a way of storing values across multiple requests from the same
user. Carolina comes with several options for a &quot;Session&quot; service.</p><h2 id="session-configuration"><a href="#session-configuration" aria-hidden="true" class="header-anchor">#</a> Session Configuration</h2><p>The following Session Service implementations are included with Carolina.
Specify the path to the one
you want to use in <code>config/app.js</code>.</p><table><thead><tr><th>Class Name</th><th>Path</th><th>Description</th></tr></thead><tbody><tr><td><strong><code>DbSessionService</code></strong></td><td><code>carolina/services/session/db-session</code></td><td>Stores session data in the database using the built-in <code>SessionInfo</code> model. This is the default for new projects.</td></tr><tr><td><code>InMemorySessionService</code></td><td><code>carolina/services/session/in-memory-session</code></td><td>Stores session data as an object in memory. Does not persist and should only be used in development.</td></tr><tr><td><code>JsonFilesSessionService</code></td><td><code>carolina/services/session/json-files-session</code></td><td>Subclass of <code>InMemorySessionService</code>, but saves session data to local files during <code>onShutdown()</code>.</td></tr><tr><td><code>NodeCacheSessionService</code></td><td><code>carolina/services/session/node-cache-session</code></td><td>Stores session data using the NPM module <code>node-cache</code>. Does not persist.</td></tr><tr><td><code>RedisSessionService</code></td><td><code>carolina/services/session/redis-session</code></td><td>Stores session data in a redis server. Works with AWS ElastiCache.</td></tr></tbody></table><h2 id="session-service-configuration"><a href="#session-service-configuration" aria-hidden="true" class="header-anchor">#</a> Session Service Configuration</h2><p>The Session Service to use is specified in <code>config/app.js</code>.
Configuration for the Session Service is located in <code>config/session.js</code>.</p><p>If you are using <code>JsonFilesSessionService</code>, you will need to have
the <code>sessionFilesDir</code> attribute point to a folder where you want JSON files
be stored. By default, it points to <code>storage/session/</code> which is also
git-ignored by default.</p><p>If you are using <code>RedisSessionService</code>, you will need to have a Redis server
set up. The <code>RedisSessionService</code> works well with AWS ElastiCache Redis
servers, provided you set up the security and permissions.
To use <code>RedisSessionService</code>, you will need to configure the <code>redisHost</code> and
<code>redisPort</code> attributes. By default, they look for &quot;REDIS_HOST&quot;
and &quot;REDIS_PORT&quot; in your <code>.env</code> file and fall back, respectively, to
&quot;localhost&quot; and &quot;6397&quot;.</p><h2 id="using-session-data"><a href="#using-session-data" aria-hidden="true" class="header-anchor">#</a> Using Session Data</h2><h3 id="accessing-session-data"><a href="#accessing-session-data" aria-hidden="true" class="header-anchor">#</a> Accessing Session Data</h3><p>By default, all incoming requests to the &quot;browser&quot; middleware group go through
the <code>SessionMiddleware</code> middleware (this is specified in <code>config/http.js</code>).
In that case, if session ID is found in the cookies of an incoming request,
and that session ID matches a valid session, the sesson data will be available
as <code>request.session</code>. In all other cases (including when the middleware
is not used at all), <code>request.session</code> will be an empty object.</p><p>Here is an example method in a route controller:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// get the key out of the session if it exists.</span>
  <span class="token keyword">let</span> specialKey <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>specialKey <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  
  <span class="token comment">// do something with the special key</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>session<span class="token punctuation">)</span> <span class="token comment">// =&gt; { specialKey: 1, csrf_token: &quot;some_token&quot;, etc... }</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="setting-session-data"><a href="#setting-session-data" aria-hidden="true" class="header-anchor">#</a> Setting Session Data</h3><p>When you create an <code>HttpResponse</code> object, it will have an empty object as
<code>response.session</code>. You can add any JSON-stringifiable data to it.</p><p>If the route is using <code>SessionMiddleware</code>, then the pre-existing session
from the request will be updated with the <code>response.session</code> (overwriting
any existing keys) and saved with the <code>SessionService</code> (and made available
in the next request).</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendText</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span>session<span class="token punctuation">.</span>specialKey <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>Be careful about what you assign to <code>response.session</code>. Some implementations
of the Session Service need to call <code>JSON.stringify</code> against the session
object. It is safest to stick to basic types (strings, numbers, arrays, objects)
and avoid insantiated classes or circular references.</p></div><p>In setting session values, you should avoid the following values which
are used by various parts of the Carolina framework:</p><ul><li><code>csrf_token</code></li><li><code>flash_messages</code></li></ul><h2 id="flash-messages"><a href="#flash-messages" aria-hidden="true" class="header-anchor">#</a> Flash Messages</h2><p>Flash Messages are special messages that will appear only on the next
request (to anywhere on your site that uses <code>SessionMiddleware</code>).
Flash message objects are stored in the session as <code>flash_messages</code>, and
old ones are automatically deleted.</p><p>Flash messages are useful for carrying information through following a
redirect.</p><p>The easiest way to use flash messages is to use the
<code>response.flash(message, title, severity)</code> method.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/other-page&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token string">&quot;You were redirected.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Attention!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token string">&quot;Your last operation was successful.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that the default title is null and the default severity is &quot;primary&quot;.
You can access this data in your pug templates as
<code>request.session.flash_messages</code>, but there is a built-in mixin
provided in <code>templates/carolina/session/mixins.pug</code>.</p><p>Suppose that after the above redirect, the controller for &quot;/other-page&quot;
returned the template below:</p><div class="language-pug extra-class"><pre class="language-pug"><code><span class="token keyword">extends carolina/base/bootstrap_base</span>

<span class="token keyword">include carolina/session/mixins</span>

<span class="token keyword">block body</span>
  <span class="token tag">div.container</span>
    <span class="token mixin"><span class="token name function">+flashMessages</span><span class="token punctuation">(</span>locals<span class="token punctuation">.</span>request<span class="token punctuation">)</span></span>
</code></pre></div><p>In that case, the relevant generated HTML would be this:</p><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert alert-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>Attention!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>
  You were redirected.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert alert-success<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  Your last operation was successful.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>You are free of course to make your own mixins to work better with frameworks
other than bootstrap.</p><h2 id="custom-session-service-implementation"><a href="#custom-session-service-implementation" aria-hidden="true" class="header-anchor">#</a> Custom Session Service Implementation</h2><p>For information on writing your own implementation of the Session Service
to work with the Carolina framework, see the
<a href="/customservices/session.html">Custom Session Service</a> page.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/basics/template-views.html" class="prev">
          Template Views
        </a></span><span class="next"><a href="/docs/basics/validation.html">
          Validation
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.1d2d3735.js" defer></script><script src="/assets/js/24.0bac6e09.js" defer></script>
  </body>
</html>
