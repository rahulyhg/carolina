<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CSRF Tokens  | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.1d2d3735.css" as="style"><link rel="preload" href="/assets/js/app.1d2d3735.js" as="script"><link rel="preload" href="/assets/js/16.5770cf46.js" as="script"><link rel="prefetch" href="/assets/js/1.f05c9cba.js"><link rel="prefetch" href="/assets/js/10.bac22d9b.js"><link rel="prefetch" href="/assets/js/11.3d8fb5fe.js"><link rel="prefetch" href="/assets/js/12.15d64a99.js"><link rel="prefetch" href="/assets/js/13.025e71f2.js"><link rel="prefetch" href="/assets/js/14.fd7a08c1.js"><link rel="prefetch" href="/assets/js/15.e1bc1756.js"><link rel="prefetch" href="/assets/js/17.853ce496.js"><link rel="prefetch" href="/assets/js/18.971e2150.js"><link rel="prefetch" href="/assets/js/19.c761800c.js"><link rel="prefetch" href="/assets/js/2.988f372d.js"><link rel="prefetch" href="/assets/js/20.4e4bef1c.js"><link rel="prefetch" href="/assets/js/21.b3aaaedf.js"><link rel="prefetch" href="/assets/js/22.1bb76f3c.js"><link rel="prefetch" href="/assets/js/23.3d27ba26.js"><link rel="prefetch" href="/assets/js/24.0bac6e09.js"><link rel="prefetch" href="/assets/js/25.c2b28b9a.js"><link rel="prefetch" href="/assets/js/26.0d288857.js"><link rel="prefetch" href="/assets/js/27.98f9eff3.js"><link rel="prefetch" href="/assets/js/28.26974ced.js"><link rel="prefetch" href="/assets/js/29.6b34c182.js"><link rel="prefetch" href="/assets/js/3.8f49772c.js"><link rel="prefetch" href="/assets/js/30.3e9f8855.js"><link rel="prefetch" href="/assets/js/31.f88a0e4e.js"><link rel="prefetch" href="/assets/js/32.cd87dfeb.js"><link rel="prefetch" href="/assets/js/33.b61fa559.js"><link rel="prefetch" href="/assets/js/34.c116294f.js"><link rel="prefetch" href="/assets/js/35.2f210b65.js"><link rel="prefetch" href="/assets/js/36.cb8e5677.js"><link rel="prefetch" href="/assets/js/37.0de8ac6f.js"><link rel="prefetch" href="/assets/js/38.cb46e1ce.js"><link rel="prefetch" href="/assets/js/39.b4986129.js"><link rel="prefetch" href="/assets/js/4.6855463a.js"><link rel="prefetch" href="/assets/js/40.a060c3fb.js"><link rel="prefetch" href="/assets/js/41.e48da89d.js"><link rel="prefetch" href="/assets/js/42.3cf3cf2d.js"><link rel="prefetch" href="/assets/js/43.74393af5.js"><link rel="prefetch" href="/assets/js/44.9d05ba51.js"><link rel="prefetch" href="/assets/js/5.00dd7cd0.js"><link rel="prefetch" href="/assets/js/6.9ca81a96.js"><link rel="prefetch" href="/assets/js/7.24dcfe4e.js"><link rel="prefetch" href="/assets/js/8.f67b2fab.js"><link rel="prefetch" href="/assets/js/9.85b5be06.js">
    <link rel="stylesheet" href="/assets/css/styles.1d2d3735.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Framework Overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Basics</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/docs/basics/routing.html" class="sidebar-link">Routing</a></li><li><a href="/docs/basics/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/docs/basics/csrf.html" class="active sidebar-link">CSRF Tokens </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/basics/csrf.html#forms" class="sidebar-link">Forms</a></li><li class="sidebar-sub-header"><a href="/docs/basics/csrf.html#javascript" class="sidebar-link">Javascript</a></li><li class="sidebar-sub-header"><a href="/docs/basics/csrf.html#excluding-routes-from-csrf" class="sidebar-link">Excluding Routes from CSRF</a></li><li class="sidebar-sub-header"><a href="/docs/basics/csrf.html#the-csrf-token-cookie" class="sidebar-link">The csrf_token Cookie</a></li></ul></li><li><a href="/docs/basics/controllers.html" class="sidebar-link">Controller Classes</a></li><li><a href="/docs/basics/requests.html" class="sidebar-link">HTTP Request Objects</a></li><li><a href="/docs/basics/responses.html" class="sidebar-link">HTTP Response Objects</a></li><li><a href="/docs/basics/template-views.html" class="sidebar-link">Template Views</a></li><li><a href="/docs/basics/session.html" class="sidebar-link">Session</a></li><li><a href="/docs/basics/validation.html" class="sidebar-link">Validation</a></li><li><a href="/docs/basics/errors.html" class="sidebar-link">Exceptions</a></li><li><a href="/docs/basics/logging.html" class="sidebar-link">Logging</a></li><li><a href="/docs/basics/pug.html" class="sidebar-link">Pug Templates</a></li><li><a href="/docs/basics/crypto.html" class="sidebar-link">The Crypto Service</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Advanced</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Databases</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Included Plugins</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="csrf-tokens"><a href="#csrf-tokens" aria-hidden="true" class="header-anchor">#</a> CSRF Tokens</h1><p>Because of the possiblity of cross-site request forgery, a protection called
CSRF tokens are very common.</p><p>For all routes that include the built-in middleware &quot;CsrfMiddleware&quot;, every
user session is assigned a CSRF token which is stored in the session.
That token is used to verify any POST, PUT, PATCH, or DELETE request.</p><p>The middleware looks for a correct token as the value
<code>csrf_token</code>
as part of <code>request.data</code> (derived from the form-data or JSON), or as the value
of the header <code>X-CSRF-TOKEN</code> or <code>X-XSRF-TOKEN</code>.
If the correct token is in any of those values, the request will be allowed
to proceed, otherwise it will be rejected.</p><h2 id="forms"><a href="#forms" aria-hidden="true" class="header-anchor">#</a> Forms</h2><p>You can include a hidden input containing the correct CSRF token in your pug
template using a mixin:</p><div class="language-pug extra-class"><pre class="language-pug"><code><span class="token keyword">include carolina/http/mixins</span>

<span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;POST&quot;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token mixin"><span class="token name function">+csrfToken</span><span class="token punctuation">(</span>local<span class="token punctuation">.</span>request<span class="token punctuation">)</span></span>
</code></pre></div><p>Note that the incoming Request object is always available when
rendering views using <code>PugTemplateView</code> as <code>locals.request</code>.
In any case where you need the CSRF token in a template but don't want to
insert the hidden input, you can access the session CSRF token as
<code>locals.request.session.csrf_token</code>.</p><h2 id="javascript"><a href="#javascript" aria-hidden="true" class="header-anchor">#</a> Javascript</h2><p>If you wish to make AJAX calls that submit POST, PUT, PATCH, or DELETE
requests, you have a few options. You could make the endpoint be part of a
route group that does not use the CSRF middleware.</p><p>The other option is to put the CSRF token in the
header <code>X-CSRF-TOKEN</code> or <code>X-XSRF-TOKEN</code>.</p><p>If you are using the Carolina frontend system (which is similar to the backend
system), you can use the Http service to make requests. The frontend Http
service will look for the CSRF token in the cookie if it exists and
automatically place its value in the <code>X-CSRF-TOKEN</code> for all requests.</p><div class="language-js extra-class"><pre class="language-js"><code>Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;Http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">Http</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> Http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/some/endpoint&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>In order for this to work, <code>csrf_token</code> must be present in the
<code>http.unencrypted_cookies</code> value.</p><p>For more on the Carolina frontend system, see the
<a href="/frontend/frontend">frontend docs</a>.</p><h2 id="excluding-routes-from-csrf"><a href="#excluding-routes-from-csrf" aria-hidden="true" class="header-anchor">#</a> Excluding Routes from CSRF</h2><p>To exclude routes from CSRF protection, put them in a route group that doesn't
make use of the <code>CSRFMiddleware</code> class.</p><h2 id="the-csrf-token-cookie"><a href="#the-csrf-token-cookie" aria-hidden="true" class="header-anchor">#</a> The <code>csrf_token</code> Cookie</h2><p>The CSRF token is stored in the cookie as <code>csrf_token</code>. If you leave the value
of <code>unencrypted_cookies</code> in <code>config/http.js</code> alone, it will be the
unencrypted CSRF token.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/basics/middleware.html" class="prev">
          Middleware
        </a></span><span class="next"><a href="/docs/basics/controllers.html">
          Controller Classes
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.1d2d3735.js" defer></script><script src="/assets/js/16.5770cf46.js" defer></script>
  </body>
</html>
