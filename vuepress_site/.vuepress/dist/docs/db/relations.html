<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reference Fields | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.1d2d3735.css" as="style"><link rel="preload" href="/assets/js/app.1d2d3735.js" as="script"><link rel="preload" href="/assets/js/31.f88a0e4e.js" as="script"><link rel="prefetch" href="/assets/js/1.f05c9cba.js"><link rel="prefetch" href="/assets/js/10.bac22d9b.js"><link rel="prefetch" href="/assets/js/11.3d8fb5fe.js"><link rel="prefetch" href="/assets/js/12.15d64a99.js"><link rel="prefetch" href="/assets/js/13.025e71f2.js"><link rel="prefetch" href="/assets/js/14.fd7a08c1.js"><link rel="prefetch" href="/assets/js/15.e1bc1756.js"><link rel="prefetch" href="/assets/js/16.5770cf46.js"><link rel="prefetch" href="/assets/js/17.853ce496.js"><link rel="prefetch" href="/assets/js/18.971e2150.js"><link rel="prefetch" href="/assets/js/19.c761800c.js"><link rel="prefetch" href="/assets/js/2.988f372d.js"><link rel="prefetch" href="/assets/js/20.4e4bef1c.js"><link rel="prefetch" href="/assets/js/21.b3aaaedf.js"><link rel="prefetch" href="/assets/js/22.1bb76f3c.js"><link rel="prefetch" href="/assets/js/23.3d27ba26.js"><link rel="prefetch" href="/assets/js/24.0bac6e09.js"><link rel="prefetch" href="/assets/js/25.c2b28b9a.js"><link rel="prefetch" href="/assets/js/26.0d288857.js"><link rel="prefetch" href="/assets/js/27.98f9eff3.js"><link rel="prefetch" href="/assets/js/28.26974ced.js"><link rel="prefetch" href="/assets/js/29.6b34c182.js"><link rel="prefetch" href="/assets/js/3.8f49772c.js"><link rel="prefetch" href="/assets/js/30.3e9f8855.js"><link rel="prefetch" href="/assets/js/32.cd87dfeb.js"><link rel="prefetch" href="/assets/js/33.b61fa559.js"><link rel="prefetch" href="/assets/js/34.c116294f.js"><link rel="prefetch" href="/assets/js/35.2f210b65.js"><link rel="prefetch" href="/assets/js/36.cb8e5677.js"><link rel="prefetch" href="/assets/js/37.0de8ac6f.js"><link rel="prefetch" href="/assets/js/38.cb46e1ce.js"><link rel="prefetch" href="/assets/js/39.b4986129.js"><link rel="prefetch" href="/assets/js/4.6855463a.js"><link rel="prefetch" href="/assets/js/40.a060c3fb.js"><link rel="prefetch" href="/assets/js/41.e48da89d.js"><link rel="prefetch" href="/assets/js/42.3cf3cf2d.js"><link rel="prefetch" href="/assets/js/43.74393af5.js"><link rel="prefetch" href="/assets/js/44.9d05ba51.js"><link rel="prefetch" href="/assets/js/5.00dd7cd0.js"><link rel="prefetch" href="/assets/js/6.9ca81a96.js"><link rel="prefetch" href="/assets/js/7.24dcfe4e.js"><link rel="prefetch" href="/assets/js/8.f67b2fab.js"><link rel="prefetch" href="/assets/js/9.85b5be06.js">
    <link rel="stylesheet" href="/assets/css/styles.1d2d3735.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Framework Overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Basics</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Advanced</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Databases</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/docs/db/db-service.html" class="sidebar-link">The DB Service</a></li><li><a href="/docs/db/schemas.html" class="sidebar-link">Schemas and Fields</a></li><li><a href="/docs/db/models.html" class="sidebar-link">Models</a></li><li><a href="/docs/db/queries.html" class="sidebar-link">Database Queries</a></li><li><a href="/docs/db/fixtures.html" class="sidebar-link">Fixtures</a></li><li><a href="/docs/db/relations.html" class="active sidebar-link">Reference Fields</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/db/relations.html#defining-references" class="sidebar-link">Defining References</a></li><li class="sidebar-sub-header"><a href="/docs/db/relations.html#querying-references" class="sidebar-link">Querying References</a></li><li class="sidebar-sub-header"><a href="/docs/db/relations.html#populating" class="sidebar-link">Populating</a></li><li class="sidebar-sub-header"><a href="/docs/db/relations.html#saving-references" class="sidebar-link">Saving References</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Included Plugins</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="reference-fields"><a href="#reference-fields" aria-hidden="true" class="header-anchor">#</a> Reference Fields</h1><p>Sometimes Model instances will need to reference instances of other Models.
An example would be a blog comment, which might reference a specific blog post.
References can be defined using certain field types in Model Schemas:</p><ul><li><code>Ref</code>: A reference to another object in a specific Model.</li><li><code>MultiRef</code>: A list of references to other objects in a specific Model.</li><li><code>GenericRef</code>: A reference to another object in any Model.</li><li><code>GenericMultiRef</code>: A list of references to other objects in any Model.</li></ul><p></p><div class="table-of-contents"><ul><li><a href="#defining-references">Defining References</a><ul><li><a href="#ref">Ref</a></li><li><a href="#multiref">MultiRef</a></li></ul></li><li><a href="#querying-references">Querying References</a></li><li><a href="#populating">Populating</a></li><li><a href="#saving-references">Saving References</a></li></ul></div><p></p><h2 id="defining-references"><a href="#defining-references" aria-hidden="true" class="header-anchor">#</a> Defining References</h2><p>References are defined in Schemas, and allow Model instances to reference
other ones.</p><p>This example assumes a Comment Model is set up to reference a Post in the
<code>post</code> property:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> Comment <span class="token operator">=</span> DBSvc<span class="token punctuation">.</span><span class="token function">_modelClass</span><span class="token punctuation">(</span><span class="token string">'Comment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> someComment <span class="token operator">=</span> <span class="token keyword">await</span> Comment<span class="token punctuation">.</span><span class="token function">$lookup</span><span class="token punctuation">(</span>commentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>someComment<span class="token punctuation">.</span>post<span class="token punctuation">)</span> <span class="token comment">// =&gt; '12345' (a Post ID)</span>
<span class="token keyword">await</span> someComment<span class="token punctuation">.</span><span class="token function">_populate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>someComment<span class="token punctuation">.</span>post<span class="token punctuation">)</span> <span class="token comment">// =&gt; Post{}</span>
</code></pre></div><h3 id="ref"><a href="#ref" aria-hidden="true" class="header-anchor">#</a><code>Ref</code></h3><p>Here is how the Schema for a Comment might look:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">CommentSchema</span> <span class="token keyword">extends</span> <span class="token class-name">BaseSchema</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>table <span class="token operator">=</span> <span class="token string">'comment'</span><span class="token punctuation">;</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'String'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// other fields here</span>
    
    <span class="token comment">// reference to a Post</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span>post <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'Ref'</span><span class="token punctuation">,</span> model<span class="token punctuation">:</span> <span class="token string">'Post'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This specifies that the <code>post</code> property of a Comment object should contain the
ID of an instance of the Post Model.</p><p>To assign a value to <code>comment.post</code>, you can use either the ID or the object
itself (as long as the ID is for sure a String).</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// assign by ID</span>
comment<span class="token punctuation">.</span>post <span class="token operator">=</span> <span class="token string">'12345'</span><span class="token punctuation">;</span>

<span class="token comment">// assign by reference</span>
<span class="token keyword">let</span> somePost <span class="token operator">=</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span><span class="token function">$lookup</span><span class="token punctuation">(</span><span class="token string">'12345'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
comment<span class="token punctuation">.</span>post <span class="token operator">=</span> somePost<span class="token punctuation">;</span>
<span class="token keyword">await</span> comment<span class="token punctuation">.</span><span class="token function">_save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="multiref"><a href="#multiref" aria-hidden="true" class="header-anchor">#</a><code>MultiRef</code></h3><p>A <code>MultiRef</code> field type is similar to <code>Ref</code> but contains an Array of
references to objects of a certain Model class.</p><p>For example, suppose you wanted the Post class to include a <code>MultiRef</code> field
referencing comments.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">PostSchema</span> <span class="token keyword">extends</span> <span class="token class-name">BaseSchema</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>table <span class="token operator">=</span> <span class="token string">'post'</span><span class="token punctuation">;</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'String'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// other fields here</span>
    
    <span class="token comment">// reference to a Post</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span>comments <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'MultiRef'</span><span class="token punctuation">,</span> model<span class="token punctuation">:</span> <span class="token string">'Comment'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>comments</code> property of a Post object would be an Array (by default an
empty one). The Array can have IDs of Comments or saved Comment objects added
to it.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// add an ID</span>
post<span class="token punctuation">.</span>comments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// add a comment object</span>
<span class="token keyword">let</span> comment <span class="token operator">=</span> <span class="token keyword">await</span> Comment<span class="token punctuation">.</span>$<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Some Title&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
post<span class="token punctuation">.</span>comments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// save</span>
<span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">_save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="querying-references"><a href="#querying-references" aria-hidden="true" class="header-anchor">#</a> Querying References</h2><p>In the Database, <code>Ref</code> fields are populated with the ID of the referenced
object as a String and <code>MultiRef</code> fields are populated with an Array of the
IDs of the referenced objects. You can query the field types accordingly:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// get all Comments belonging to Post ID 1234</span>
<span class="token keyword">let</span> comments <span class="token operator">=</span> <span class="token keyword">await</span> Comment<span class="token punctuation">.</span><span class="token function">$query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> post<span class="token punctuation">:</span> <span class="token string">'1234'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// get the Post that contains a given Comment with ID 1234</span>
<span class="token keyword">let</span> post <span class="token operator">=</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span>$<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  __constraints<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    comments<span class="token punctuation">:</span> <span class="token punctuation">{</span> contains<span class="token punctuation">:</span> <span class="token string">'1234'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="populating"><a href="#populating" aria-hidden="true" class="header-anchor">#</a> Populating</h2><p>When you instantiate an object from the database, it's Reference fields will
contain IDs. If you want to populate the fields, you need to use
the <code>_populate(fieldNames)</code> method of the Base Model class.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; ['1234', '5678']</span>

<span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">_populate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'roles'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; [Role{id:'1234'},Role{id:'5678'}]</span>
</code></pre></div><h2 id="saving-references"><a href="#saving-references" aria-hidden="true" class="header-anchor">#</a> Saving References</h2><div class="danger custom-block"><p class="custom-block-title">IMPORTANT</p><p>Please note that you MUST save the reference objects yourself. Calling the
<code>_save()</code> method of a Post will not save changes you have made to referenced
Comments.</p></div></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/db/fixtures.html" class="prev">
          Fixtures
        </a></span><span class="next"><a href="/docs/plugins/admin.html">
          Carolina Admin
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.1d2d3735.js" defer></script><script src="/assets/js/31.f88a0e4e.js" defer></script>
  </body>
</html>
