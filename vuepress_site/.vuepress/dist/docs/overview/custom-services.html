<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Custom Services | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.4c99cee3.css" as="style"><link rel="preload" href="/assets/js/app.4c99cee3.js" as="script"><link rel="preload" href="/assets/js/36.4b18f55f.js" as="script"><link rel="prefetch" href="/assets/js/1.1cf9f1db.js"><link rel="prefetch" href="/assets/js/10.67736b9c.js"><link rel="prefetch" href="/assets/js/11.7beeac27.js"><link rel="prefetch" href="/assets/js/12.8ffce904.js"><link rel="prefetch" href="/assets/js/13.54a86374.js"><link rel="prefetch" href="/assets/js/14.f6222131.js"><link rel="prefetch" href="/assets/js/15.60843f1a.js"><link rel="prefetch" href="/assets/js/16.3bab9827.js"><link rel="prefetch" href="/assets/js/17.371a0e2c.js"><link rel="prefetch" href="/assets/js/18.2bf4752f.js"><link rel="prefetch" href="/assets/js/19.d7b2b433.js"><link rel="prefetch" href="/assets/js/2.d296c8c8.js"><link rel="prefetch" href="/assets/js/20.84f7874a.js"><link rel="prefetch" href="/assets/js/21.b063a67b.js"><link rel="prefetch" href="/assets/js/22.75e8e46c.js"><link rel="prefetch" href="/assets/js/23.c3543ea8.js"><link rel="prefetch" href="/assets/js/24.5c5f18c8.js"><link rel="prefetch" href="/assets/js/25.64098a0b.js"><link rel="prefetch" href="/assets/js/26.e2acfd13.js"><link rel="prefetch" href="/assets/js/27.aff06937.js"><link rel="prefetch" href="/assets/js/28.8bc12e94.js"><link rel="prefetch" href="/assets/js/29.c7890b85.js"><link rel="prefetch" href="/assets/js/3.79b6242f.js"><link rel="prefetch" href="/assets/js/30.1c7523a4.js"><link rel="prefetch" href="/assets/js/31.41d153ce.js"><link rel="prefetch" href="/assets/js/32.076ea23e.js"><link rel="prefetch" href="/assets/js/33.4df50c49.js"><link rel="prefetch" href="/assets/js/34.afd39df7.js"><link rel="prefetch" href="/assets/js/35.96ad804d.js"><link rel="prefetch" href="/assets/js/37.785cf241.js"><link rel="prefetch" href="/assets/js/38.8ff035ad.js"><link rel="prefetch" href="/assets/js/39.e0c013ee.js"><link rel="prefetch" href="/assets/js/4.455a7b47.js"><link rel="prefetch" href="/assets/js/40.141dd392.js"><link rel="prefetch" href="/assets/js/41.c0c4f533.js"><link rel="prefetch" href="/assets/js/42.a505c995.js"><link rel="prefetch" href="/assets/js/43.9538af71.js"><link rel="prefetch" href="/assets/js/44.4a09b0cb.js"><link rel="prefetch" href="/assets/js/45.01328d52.js"><link rel="prefetch" href="/assets/js/46.d54fdc6d.js"><link rel="prefetch" href="/assets/js/47.93af6532.js"><link rel="prefetch" href="/assets/js/48.3aecbfc9.js"><link rel="prefetch" href="/assets/js/49.030d249e.js"><link rel="prefetch" href="/assets/js/5.39ac8b79.js"><link rel="prefetch" href="/assets/js/50.830dbfe7.js"><link rel="prefetch" href="/assets/js/51.8883ddf5.js"><link rel="prefetch" href="/assets/js/52.0e11daf2.js"><link rel="prefetch" href="/assets/js/53.fc4fea9f.js"><link rel="prefetch" href="/assets/js/54.224ab9d2.js"><link rel="prefetch" href="/assets/js/55.57f73974.js"><link rel="prefetch" href="/assets/js/56.f67ded59.js"><link rel="prefetch" href="/assets/js/6.53b715ea.js"><link rel="prefetch" href="/assets/js/7.3c48cb9f.js"><link rel="prefetch" href="/assets/js/8.23ab337a.js"><link rel="prefetch" href="/assets/js/9.01843353.js">
    <link rel="stylesheet" href="/assets/css/styles.4c99cee3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">Tutorial</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">Tutorial</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Framework Overview</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/docs/overview/process.html" class="sidebar-link">Basic Server Process</a></li><li><a href="/docs/overview/service-library.html" class="sidebar-link">The Carolina Global Object</a></li><li><a href="/docs/overview/custom-services.html" class="active sidebar-link">Custom Services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/overview/custom-services.html#writing-services" class="sidebar-link">Writing Services</a></li><li class="sidebar-sub-header"><a href="/docs/overview/custom-services.html#registering-services" class="sidebar-link">Registering Services</a></li></ul></li><li><a href="/docs/overview/services.html" class="sidebar-link">Framework Services &amp; Class Libraries</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Basics</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Advanced</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Databases</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Included Plugins</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="custom-services"><a href="#custom-services" aria-hidden="true" class="header-anchor">#</a> Custom Services</h1><p>As discussed in the
<a href="/docs/overview/service-library.html">previous section</a>, the global Carolina
object maintains a library of Services. The Services which will be available
are the ones listed in the <code>services</code> property in the file <code>config/app.js</code>.
Most of them are part of the Carolina framework, but one (which is called
&quot;App&quot;) is defined in the starter project as a starting point for a custom
Service.</p><p>This section covers writing your own custom Service.</p><h2 id="writing-services"><a href="#writing-services" aria-hidden="true" class="header-anchor">#</a> Writing Services</h2><p>All Services, custom or otherwise, must extend the <code>BaseService</code> class,
which is exported by the file <code>carolina/services/base-service.js</code>.</p><p>You can generate a new Service using the CLI:</p><div class="language- extra-class"><pre class="language-text"><code>node . generate service MyCustomService
</code></pre></div><p>The above command would generate a new Service class in the file
<code>site/main/services/my-custom-service.js</code>.</p><h3 id="the-service-constructor"><a href="#the-service-constructor" aria-hidden="true" class="header-anchor">#</a> The Service Constructor</h3><p>Generally, very little should take place in the constructor for a Service.
You should <strong>not</strong> attempt to reference any other Services in the constructor.
Because the Carolina global object makes Services available on demand, you
shouldn't have to either. The constructor should take no arguments, and
should pass its name to the constructor of <code>BaseService</code>. It is not required
that this name actually match the name under which the Service will be available
from the Carolina object, but it will be used in some logging messages.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCustomService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">'MyCustomService'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// basic initialization, if necessary</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>someKey <span class="token operator">=</span> <span class="token string">'someValue'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once this Service is registered, the constructor will only be called once the
first time this Service is needed by your application.</p><h3 id="service-methods"><a href="#service-methods" aria-hidden="true" class="header-anchor">#</a> Service Methods</h3><p>You can define your own custom methods on the Service, and this is probably
the main use for a service.</p><p>Avoid naming methods that start with an underscore and don't call any method
<code>onShutdown()</code> unless you are intending to write the <code>onShutdown()</code> method.
If you follow these rules, everything should be fine.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCustomService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// constructor </span>
  
  <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If the above Service were properly registered, you could then do the following
from any part of your application:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> MyCustomSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'MyCustomService'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> twentyFive <span class="token operator">=</span> MyCustomSvc<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>The <code>onShutdown</code> Method</strong></p><p>The <code>onShutdown()</code> async method is called and awaited on every Service when
the application shuts down - so do anything that needs to be done there.
Your Service will be initialized even if it wasn't used at all during the
application lifecycle, and the <code>onShutdown</code> method will be called and
awaited (and given no arguments).</p><h3 id="service-libraries"><a href="#service-libraries" aria-hidden="true" class="header-anchor">#</a> Service Libraries</h3><p>As is covered in later sections, some Services maintain libraries of class
definitions and/or singletons of a certian type. This is more advanced - and
is probably mostly useful if you are writing a plugin, but
if you wish for your
Service to do this, there are some helper methods to make this easy.</p><p>For context and some examples,
the DB Service maintains class libraries of Models and Fields,
the Http Service maintains libraries of Controller and Middleware singletons,
and the Events Service maintains a library of Listener singletons and
Event classes. The classes that make up these libraries are defined in the
Carolina framework but can be loaded from your <code>site/</code> directory as well.
In fact, this is how the Http Service gets access to your custom
Controllers and Middleware, for example.</p><p>Suppose that you want your custom Service to maintain a library of
singletons that provide the ability to make a post on various social media
platforms. You want all those singletons to be of classes that implement
a certain API but define different details under the hood.
In this case, you might want to elsewhere define a <code>BaseSocialMediaConnection</code>
class and document that all social media connection classes must subclass it.</p><p>You would also decide where these things should be defined in the site
directory. Perhaps under the directory <code>site/social/connections/</code>.</p><p>You would want to do this in the constructor:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCustomService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// other stuff</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initializeLibrary</span><span class="token punctuation">(</span><span class="token string">&quot;socialConnectionClasses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;socialConnections&quot;</span><span class="token punctuation">,</span>
      <span class="token string">'social/connections'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;social media connection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>_initializeLibrary</code> method is defined as part of <code>BaseService</code>.
Its arguments are as follows (in order):</p><ul><li><code>classLibraryName</code>: The name of an object to store the class library.</li><li><code>instanceLibraryName</code>: The name of an object to store the insantiations.</li><li><code>location</code>: Where to look in the <code>site/</code> directory or in plugins for class definitions.</li><li><code>initialClasses</code>: Any classes that should be a part of the library automatically.</li><li><code>name</code>: A user-friendly name for the object type, helpful for error messages but otherwise irrelevant.</li></ul><p>The method does the following things when called.</p><ul><li>Create the property <code>socialConnectionClasses</code> on your service and initialize it to the 4th argument provided.</li><li>Create the property <code>socialConnections</code> on your service and initialize it as an empty object.</li><li>Update <code>socialConnectionClasses</code> with whatever is exposed by <code>site/social/connections.js</code> or <code>site/social/connections/index.js</code>.</li><li>Update <code>socialConnectionClasses</code> with whatever is exposed by <code>&lt;plugin_dir&gt;/plugin/social/connections.js</code> or <code>&lt;plugin_dir&gt;/plugin/social/connections/index.js</code> for each installed plugin.</li></ul><p>At the end of this, your Service object will have a <code>socialConnectionClasses</code>
property that is an object mapping names to classes.</p><p>If you want to defined social media connections, the file
<code>site/social/connections/index.js</code> should export like so:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'FacebookConnect'</span><span class="token punctuation">:</span> FacebookConnect<span class="token punctuation">,</span> <span class="token comment">// some class</span>
  <span class="token string">'TwitterConnect'</span><span class="token punctuation">:</span> TwitterConnect   <span class="token comment">// also some class</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>You will need to do one more thing, if you want these things to be a library
of singletons:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCustomService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// constructor</span>
  
  <span class="token function">_socialConnection</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_lazyLoadObject</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'socialConnectionClasses'</span><span class="token punctuation">,</span>
      <span class="token string">'socialConnections'</span><span class="token punctuation">,</span> <span class="token string">&quot;social connection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this, the 2nd and 3rd arguments to <code>_lazyLoadObject</code> must match the
1st and 2nd arguments to <code>_initializeLibrary</code>. The final argument is again
cosmetic.</p><p>What this does is take a name, check the property <code>socialConnections</code> for
an existing instance. If one is found, that instance is returned. Otherwise,
the <code>socialConnectionClasses</code> property is checked for a class definition. If
one is found, it is instantiated (with no arguments to the constructor) and
stored in <code>socialConnections</code> for future use and returned. If there is no
existing instance and no class defined, an error like
&quot;no matching social connection&quot; will be raised.</p><p>If this is all done properly, you could do the following from any part of the
application:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> MyCustomSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'MyCustomService'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> facebookConnection <span class="token operator">=</span> MyCustomSvc<span class="token punctuation">.</span><span class="token function">_socialConnection</span><span class="token punctuation">(</span><span class="token string">'FacebookConnect'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
facebookConnection<span class="token punctuation">.</span><span class="token function">makePost</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Singleton libraries like this probably make the most sense in this context,
but suppose you wanted to make it only a class library of uninstantiated
classes. You would do the same thing in the constructor, but do this
as a method instead:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCustomService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// constructor</span>
  
  <span class="token function">_socialConnectionClass</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'socialConnectionClasses'</span><span class="token punctuation">,</span> <span class="token string">'social connection'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this case, the 2nd argument to <code>_loadClass</code> must match the 1st argument
to <code>_initializeLibrary</code>. This simply returns the class, allowing this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> MyCustomSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'MyCustomService'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> FacebookConnect <span class="token operator">=</span> MyCustomSvc<span class="token punctuation">.</span><span class="token function">_socialConnectionClass</span><span class="token punctuation">(</span><span class="token string">'FacebookConnect'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
facebookConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FacebookConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="registering-services"><a href="#registering-services" aria-hidden="true" class="header-anchor">#</a> Registering Services</h2><p>To property register your new Service, you add the following to <code>services</code>
under <code>config/app.js</code>:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// other services</span>
  
  MyCustomService<span class="token punctuation">:</span> <span class="token string">&quot;./site/services/my-custom-service&quot;</span><span class="token punctuation">,</span>
  
  <span class="token comment">// yet more services</span>
</code></pre></div><p>This is what allows <code>Carolina.$('MyCustomService');</code> to work.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/overview/service-library.html" class="prev">
          The Carolina Global Object
        </a></span><span class="next"><a href="/docs/overview/services.html">
          Framework Services &amp; Class Libraries
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.4c99cee3.js" defer></script><script src="/assets/js/36.4b18f55f.js" defer></script>
  </body>
</html>
