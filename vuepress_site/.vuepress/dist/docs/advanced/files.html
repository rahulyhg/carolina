<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Working with Files | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.1d2d3735.css" as="style"><link rel="preload" href="/assets/js/app.1d2d3735.js" as="script"><link rel="preload" href="/assets/js/6.9ca81a96.js" as="script"><link rel="prefetch" href="/assets/js/1.f05c9cba.js"><link rel="prefetch" href="/assets/js/10.bac22d9b.js"><link rel="prefetch" href="/assets/js/11.3d8fb5fe.js"><link rel="prefetch" href="/assets/js/12.15d64a99.js"><link rel="prefetch" href="/assets/js/13.025e71f2.js"><link rel="prefetch" href="/assets/js/14.fd7a08c1.js"><link rel="prefetch" href="/assets/js/15.e1bc1756.js"><link rel="prefetch" href="/assets/js/16.5770cf46.js"><link rel="prefetch" href="/assets/js/17.853ce496.js"><link rel="prefetch" href="/assets/js/18.971e2150.js"><link rel="prefetch" href="/assets/js/19.c761800c.js"><link rel="prefetch" href="/assets/js/2.988f372d.js"><link rel="prefetch" href="/assets/js/20.4e4bef1c.js"><link rel="prefetch" href="/assets/js/21.b3aaaedf.js"><link rel="prefetch" href="/assets/js/22.1bb76f3c.js"><link rel="prefetch" href="/assets/js/23.3d27ba26.js"><link rel="prefetch" href="/assets/js/24.0bac6e09.js"><link rel="prefetch" href="/assets/js/25.c2b28b9a.js"><link rel="prefetch" href="/assets/js/26.0d288857.js"><link rel="prefetch" href="/assets/js/27.98f9eff3.js"><link rel="prefetch" href="/assets/js/28.26974ced.js"><link rel="prefetch" href="/assets/js/29.6b34c182.js"><link rel="prefetch" href="/assets/js/3.8f49772c.js"><link rel="prefetch" href="/assets/js/30.3e9f8855.js"><link rel="prefetch" href="/assets/js/31.f88a0e4e.js"><link rel="prefetch" href="/assets/js/32.cd87dfeb.js"><link rel="prefetch" href="/assets/js/33.b61fa559.js"><link rel="prefetch" href="/assets/js/34.c116294f.js"><link rel="prefetch" href="/assets/js/35.2f210b65.js"><link rel="prefetch" href="/assets/js/36.cb8e5677.js"><link rel="prefetch" href="/assets/js/37.0de8ac6f.js"><link rel="prefetch" href="/assets/js/38.cb46e1ce.js"><link rel="prefetch" href="/assets/js/39.b4986129.js"><link rel="prefetch" href="/assets/js/4.6855463a.js"><link rel="prefetch" href="/assets/js/40.a060c3fb.js"><link rel="prefetch" href="/assets/js/41.e48da89d.js"><link rel="prefetch" href="/assets/js/42.3cf3cf2d.js"><link rel="prefetch" href="/assets/js/43.74393af5.js"><link rel="prefetch" href="/assets/js/44.9d05ba51.js"><link rel="prefetch" href="/assets/js/5.00dd7cd0.js"><link rel="prefetch" href="/assets/js/7.24dcfe4e.js"><link rel="prefetch" href="/assets/js/8.f67b2fab.js"><link rel="prefetch" href="/assets/js/9.85b5be06.js">
    <link rel="stylesheet" href="/assets/css/styles.1d2d3735.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Framework Overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Basics</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Advanced</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/docs/advanced/cli.html" class="sidebar-link">CLI</a></li><li><a href="/docs/advanced/events.html" class="sidebar-link">Events</a></li><li><a href="/docs/advanced/web-sockets.html" class="sidebar-link">Web Sockets</a></li><li><a href="/docs/advanced/files.html" class="active sidebar-link">Working with Files</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#interacting-with-drives" class="sidebar-link">Interacting with Drives</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#file-access" class="sidebar-link">File Access</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#storing-files" class="sidebar-link">Storing Files</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#deleting-files" class="sidebar-link">Deleting Files</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#listing-files" class="sidebar-link">Listing Files</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#getting-the-actual-file" class="sidebar-link">Getting the Actual File</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/files.html#custom-file-drivers" class="sidebar-link">Custom File Drivers</a></li></ul></li><li><a href="/docs/advanced/email.html" class="sidebar-link">Email</a></li><li><a href="/docs/advanced/plugins.html" class="sidebar-link">Plugins</a></li><li><a href="/docs/advanced/jobs.html" class="sidebar-link">Jobs</a></li><li><a href="/docs/advanced/testing.html" class="sidebar-link">Testing</a></li><li><a href="/docs/advanced/requests.html" class="sidebar-link">The Requests Service</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Databases</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Included Plugins</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="working-with-files"><a href="#working-with-files" aria-hidden="true" class="header-anchor">#</a> Working with Files</h1><p>The Files Service of the framework manages access to files via three or more
drives, each managed by a type of driver. The driver may manage file access to
local files, or files on a Google Driver or Dropbox Account.</p><p></p><div class="table-of-contents"><ul><li><a href="#configuration">Configuration</a><ul><li><a href="#drivers">Drivers</a></li></ul></li><li><a href="#interacting-with-drives">Interacting with Drives</a></li><li><a href="#file-access">File Access</a><ul><li><a href="#getting-files">Getting Files</a></li><li><a href="#public-file-urls">Public File URLs</a></li></ul></li><li><a href="#storing-files">Storing Files</a><ul><li><a href="#append">Append</a></li><li><a href="#handling-file-uploads">Handling File Uploads</a></li></ul></li><li><a href="#deleting-files">Deleting Files</a></li><li><a href="#listing-files">Listing Files</a></li><li><a href="#getting-the-actual-file">Getting the Actual File</a></li><li><a href="#custom-file-drivers">Custom File Drivers</a></li></ul></div><p></p><h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2><p>The Files Service is configured by the file <code>config/files.js</code>. In this file,
you can specify your file drives. Think of drives a different file systems
that you can access from your application. You can have as many
file drives you want,
but at least three must exist ('public', 'private', and 'temp'). Those are
used by the framework. The 'private' drive is
for files that should not be fully
public (such as user files), the 'public' drive is for files that should be
downloadable by the public. The 'temp' drive is for short-lived files that may
not need to survive application restarts. The 'public' and 'private' drives
can use any driver, but the 'temp' drive should use the <code>LocalFileDriver</code>.</p><p>Example configuration:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>  fileDrives<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    temp<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      driver<span class="token punctuation">:</span> <span class="token string">&quot;LocalFileDriver&quot;</span><span class="token punctuation">,</span>
      basepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.tmp&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'public'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      driver<span class="token punctuation">:</span> <span class="token string">&quot;LocalFileDriver&quot;</span><span class="token punctuation">,</span>
      basepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;files&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      isPublic<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// this should match</span>
      publicPrefix<span class="token punctuation">:</span> <span class="token string">&quot;/files/&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'private'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      driver<span class="token punctuation">:</span> <span class="token string">&quot;LocalFileDriver&quot;</span><span class="token punctuation">,</span>
      basepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;files&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>The public drive is set to <code>public/files/</code> using the <code>LocalFileDriver</code>
by default. Its public prefix is the path that links to files should be
preceded by. The prefix '/files/' is used because the <code>public/</code> directory
is served to the public by the Http Service.</p><h3 id="drivers"><a href="#drivers" aria-hidden="true" class="header-anchor">#</a> Drivers</h3><p>The Files Service manages the drives, which are each managed by a specific
File Driver, a class which controls access to files.</p><h4 id="localfiledriver"><a href="#localfiledriver" aria-hidden="true" class="header-anchor">#</a><code>LocalFileDriver</code></h4><p>The easiest driver to use is the <code>LocalFileDriver</code>, which simply manages access
to files on the local server. Configuring a driver that will use the
<code>LocalFileDriver</code> requires the <code>basepath</code> property, which is the path on
the local filesystem that will be used as the drive root.</p><p>Example:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string">'private'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    driver<span class="token punctuation">:</span> <span class="token string">'LocalFileDriver'</span><span class="token punctuation">,</span>
    basepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'storage'</span><span class="token punctuation">,</span> <span class="token string">'files'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>This means that the private drive will be the local directory
<code>storage/files/</code>. That means that
saving the file &quot;images/private_image.png&quot; using the drive will create the
file <code>storage/files/images/private_image.png</code>.</p><p>If the drive is meant to be public, you can also set <code>isPublic</code> to <code>true</code>
and <code>publicPrefix</code> to a URL to the directory as is accessible via the internet:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string">'public'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      driver<span class="token punctuation">:</span> <span class="token string">&quot;LocalFileDriver&quot;</span><span class="token punctuation">,</span>
      basepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;files&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      isPublic<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// this should match</span>
      publicPrefix<span class="token punctuation">:</span> <span class="token string">&quot;/files/&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="ftpfiledriver"><a href="#ftpfiledriver" aria-hidden="true" class="header-anchor">#</a><code>FtpFileDriver</code></h4><p>The <code>FtpFileDriver</code> allows using a remote FTP server as the file drive and
it is configured this way:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string">'private'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    driver<span class="token punctuation">:</span> <span class="token string">'FtpFileDriver'</span><span class="token punctuation">,</span>
    ftpHost<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    ftpUser<span class="token punctuation">:</span> <span class="token string">'ftpuser'</span><span class="token punctuation">,</span>
    ftpPass<span class="token punctuation">:</span> <span class="token string">'ftppass'</span><span class="token punctuation">,</span>
    isSftp<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>The <code>isSftp</code> property defaults to <code>false</code>. Use <code>true</code> to make an SFTP connection
using <a href="https://www.npmjs.com/package/promise-sftp" target="_blank" rel="noopener noreferrer">promise-sftp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Otherwise,
the connection is made with
<a href="https://www.npmjs.com/package/promise-ftp" target="_blank" rel="noopener noreferrer">promise-ftp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><h4 id="dropboxfiledriver"><a href="#dropboxfiledriver" aria-hidden="true" class="header-anchor">#</a><code>DropboxFileDriver</code></h4><p>Another driver options is the <code>DropboxFileDriver</code>, which uses the
<a href="https://www.npmjs.com/package/dropbox" target="_blank" rel="noopener noreferrer">dropbox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> NPM module to communicate
with an existing Dropbox account. You will need to get an access token from
Dropbox in order to use it. Here is how it is configured:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string">'private'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    driver<span class="token punctuation">:</span> <span class="token string">'DropboxFileDriver'</span><span class="token punctuation">,</span>
    accessToken<span class="token punctuation">:</span> <span class="token string">'YOUR_ACCESS_TOKEN'</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>It is recommended that you store the access token in the <code>.env</code> file
(like <code>DROPBOX_TOKEN=abcdef</code>, and
configure the drive this way:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string">'private'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    driver<span class="token punctuation">:</span> <span class="token string">'DropboxFileDriver'</span><span class="token punctuation">,</span>
    accessToken<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DROPBOX_TOKEN</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="interacting-with-drives"><a href="#interacting-with-drives" aria-hidden="true" class="header-anchor">#</a> Interacting with Drives</h2><p>Each instance of a driver is known as a driver, and is available from the
<code>drives</code> property of the Files Service:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> FilesSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'Files'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> TempDrive <span class="token operator">=</span> FilesSvc<span class="token punctuation">.</span>drivers<span class="token punctuation">.</span>temp<span class="token punctuation">;</span>
<span class="token keyword">let</span> PublicDrive <span class="token operator">=</span> FilesSvc<span class="token punctuation">.</span>drivers<span class="token punctuation">.</span>public<span class="token punctuation">;</span>
<span class="token keyword">let</span> PrivateDrive <span class="token operator">=</span> FilesSvc<span class="token punctuation">.</span>drives<span class="token punctuation">.</span>private<span class="token punctuation">;</span>
</code></pre></div><h2 id="file-access"><a href="#file-access" aria-hidden="true" class="header-anchor">#</a> File Access</h2><h3 id="getting-files"><a href="#getting-files" aria-hidden="true" class="header-anchor">#</a> Getting Files</h3><p>To check if a file exists in a drive:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> exists <span class="token operator">=</span> <span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; true</span>
<span class="token keyword">let</span> exists2 <span class="token operator">=</span> <span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">'some_dir/file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
</code></pre></div><p>To get the Buffer of a file's contents:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> exists <span class="token operator">=</span> <span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// throws an error if file does not exist</span>
  <span class="token keyword">let</span> fileData <span class="token operator">=</span> <span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &lt;Buffer ... &gt;</span>
  <span class="token keyword">let</span> fileString <span class="token operator">=</span> fileData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;This is my file contents.&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="public-file-urls"><a href="#public-file-urls" aria-hidden="true" class="header-anchor">#</a> Public File URLs</h3><p>The &quot;public&quot; drive, and perhaps any additional drives that you configure,
should be configured with a <code>publicPrefix</code> (in the case of <code>FtpFileDriver</code>
and <code>LocalFileDriver</code>). This allows the drive to generate a link that you
can include in your application:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> downloadLink <span class="token operator">=</span> PublicDrive<span class="token punctuation">.</span><span class="token function">getPublicUrl</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; '/files/file.txt'</span>
</code></pre></div><h2 id="storing-files"><a href="#storing-files" aria-hidden="true" class="header-anchor">#</a> Storing Files</h2><p>You can easily add a new file using a String or Buffer as its contents:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'new.txt'</span><span class="token punctuation">,</span> <span class="token string">&quot;Contents of new file.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>writeFile</code> method will throw a <code>FileExistsError</code> if the file already
exists. To write a file and overwrite in the event that it exists, use
the <code>overwriteFile</code> method:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">overwriteFile</span><span class="token punctuation">(</span><span class="token string">'possibly_existing_file.txt'</span><span class="token punctuation">,</span> <span class="token string">'New content.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="append"><a href="#append" aria-hidden="true" class="header-anchor">#</a> Append</h3><p>The <code>appendToFile</code> method will add to an existing file. A <code>FileNotFoundError</code>
will be thrown if the file does not already exist:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">appendToFile</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">,</span> <span class="token string">'additional piece of data.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="handling-file-uploads"><a href="#handling-file-uploads" aria-hidden="true" class="header-anchor">#</a> Handling File Uploads</h3><p>Carolina automatically supports uploading files via <code>multipart/form-data</code>
POST requests. Any files uploaded will be placed in your &quot;temp&quot; drive
with a random name
(Note that the temp drive MUST be a local directory).
Information about it will be available in the underlying
Express request:</p><p>For example, if a file form input had the name of <code>upload</code>, then info about the
uploaded file would be available like this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">let</span> fileInfo <span class="token operator">=</span> request<span class="token punctuation">.</span>_req<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token comment">// =&gt; /path/to/temp/random_string.txt</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span>originalFilename<span class="token punctuation">)</span> <span class="token comment">// =&gt; file.txt</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You should then read the file and put it in another drive, as the temp
drive is meant for staging.</p><h2 id="deleting-files"><a href="#deleting-files" aria-hidden="true" class="header-anchor">#</a> Deleting Files</h2><p>You can use the <code>deleteFile</code> method of a Driver to remove a file from a drive.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> PublicDrive<span class="token punctuation">.</span><span class="token function">deleteFile</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; true if existed and deleted, false if didn't exist or failed</span>
</code></pre></div><h2 id="listing-files"><a href="#listing-files" aria-hidden="true" class="header-anchor">#</a> Listing Files</h2><p>You can use the <code>listFiles</code> method to list all the files in a drive,
or all the files below a certain directory level:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> fullDriveList <span class="token operator">=</span> <span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; ['file.txt', 'some_dir/file.txt', ...]</span>
<span class="token keyword">let</span> partialDriveList <span class="token operator">=</span> <span class="token keyword">await</span> PrivateDrive<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token string">'some_dir/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; ['some_dir/file.txt', ...]</span>
</code></pre></div><h2 id="getting-the-actual-file"><a href="#getting-the-actual-file" aria-hidden="true" class="header-anchor">#</a> Getting the Actual File</h2><p>If you need to access the actual file in question, transfer it to a drive that
is implemented by an instance of <code>LocalFileDriver</code>. That driver, and only
that driver, has a <code>getFullPath</code> method, which will return the local path
to the file.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> fullPath <span class="token operator">=</span> TempDrive<span class="token punctuation">.</span><span class="token function">getFullPath</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> contents <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="custom-file-drivers"><a href="#custom-file-drivers" aria-hidden="true" class="header-anchor">#</a> Custom File Drivers</h2><p>You could write your own File Driver type to be interchangeable with any of the
existing drivers.</p><p>You can generate a new File Driver class using the CLI:</p><div class="language- extra-class"><pre class="language-text"><code>node . generate file-driver MyCustomFileDriver
</code></pre></div><p>That would create the new file
<code>site/files/file-drivers/my-custom-file-driver.js</code>.</p><p>The methods that must be implemented are defined and documented in the newly
generated file. Once those are complete, the new file driver must be
exported by name from
<code>site/files/file-drivers/index.js</code>:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * Custom file drivers.
 */</span>
exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  MyCustomFileDriver<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./my-custom-file-driver'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/advanced/web-sockets.html" class="prev">
          Web Sockets
        </a></span><span class="next"><a href="/docs/advanced/email.html">
          Email
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.1d2d3735.js" defer></script><script src="/assets/js/6.9ca81a96.js" defer></script>
  </body>
</html>
