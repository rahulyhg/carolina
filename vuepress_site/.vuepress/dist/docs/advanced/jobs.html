<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jobs | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.1d2d3735.css" as="style"><link rel="preload" href="/assets/js/app.1d2d3735.js" as="script"><link rel="preload" href="/assets/js/7.24dcfe4e.js" as="script"><link rel="prefetch" href="/assets/js/1.f05c9cba.js"><link rel="prefetch" href="/assets/js/10.bac22d9b.js"><link rel="prefetch" href="/assets/js/11.3d8fb5fe.js"><link rel="prefetch" href="/assets/js/12.15d64a99.js"><link rel="prefetch" href="/assets/js/13.025e71f2.js"><link rel="prefetch" href="/assets/js/14.fd7a08c1.js"><link rel="prefetch" href="/assets/js/15.e1bc1756.js"><link rel="prefetch" href="/assets/js/16.5770cf46.js"><link rel="prefetch" href="/assets/js/17.853ce496.js"><link rel="prefetch" href="/assets/js/18.971e2150.js"><link rel="prefetch" href="/assets/js/19.c761800c.js"><link rel="prefetch" href="/assets/js/2.988f372d.js"><link rel="prefetch" href="/assets/js/20.4e4bef1c.js"><link rel="prefetch" href="/assets/js/21.b3aaaedf.js"><link rel="prefetch" href="/assets/js/22.1bb76f3c.js"><link rel="prefetch" href="/assets/js/23.3d27ba26.js"><link rel="prefetch" href="/assets/js/24.0bac6e09.js"><link rel="prefetch" href="/assets/js/25.c2b28b9a.js"><link rel="prefetch" href="/assets/js/26.0d288857.js"><link rel="prefetch" href="/assets/js/27.98f9eff3.js"><link rel="prefetch" href="/assets/js/28.26974ced.js"><link rel="prefetch" href="/assets/js/29.6b34c182.js"><link rel="prefetch" href="/assets/js/3.8f49772c.js"><link rel="prefetch" href="/assets/js/30.3e9f8855.js"><link rel="prefetch" href="/assets/js/31.f88a0e4e.js"><link rel="prefetch" href="/assets/js/32.cd87dfeb.js"><link rel="prefetch" href="/assets/js/33.b61fa559.js"><link rel="prefetch" href="/assets/js/34.c116294f.js"><link rel="prefetch" href="/assets/js/35.2f210b65.js"><link rel="prefetch" href="/assets/js/36.cb8e5677.js"><link rel="prefetch" href="/assets/js/37.0de8ac6f.js"><link rel="prefetch" href="/assets/js/38.cb46e1ce.js"><link rel="prefetch" href="/assets/js/39.b4986129.js"><link rel="prefetch" href="/assets/js/4.6855463a.js"><link rel="prefetch" href="/assets/js/40.a060c3fb.js"><link rel="prefetch" href="/assets/js/41.e48da89d.js"><link rel="prefetch" href="/assets/js/42.3cf3cf2d.js"><link rel="prefetch" href="/assets/js/43.74393af5.js"><link rel="prefetch" href="/assets/js/44.9d05ba51.js"><link rel="prefetch" href="/assets/js/5.00dd7cd0.js"><link rel="prefetch" href="/assets/js/6.9ca81a96.js"><link rel="prefetch" href="/assets/js/8.f67b2fab.js"><link rel="prefetch" href="/assets/js/9.85b5be06.js">
    <link rel="stylesheet" href="/assets/css/styles.1d2d3735.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Framework Overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Basics</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Advanced</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/docs/advanced/cli.html" class="sidebar-link">CLI</a></li><li><a href="/docs/advanced/events.html" class="sidebar-link">Events</a></li><li><a href="/docs/advanced/web-sockets.html" class="sidebar-link">Web Sockets</a></li><li><a href="/docs/advanced/files.html" class="sidebar-link">Working with Files</a></li><li><a href="/docs/advanced/email.html" class="sidebar-link">Email</a></li><li><a href="/docs/advanced/plugins.html" class="sidebar-link">Plugins</a></li><li><a href="/docs/advanced/jobs.html" class="active sidebar-link">Jobs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/advanced/jobs.html#activating-the-cron-service" class="sidebar-link">Activating the Cron Service</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/jobs.html#job-classes" class="sidebar-link">Job Classes</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/jobs.html#schedule-classes" class="sidebar-link">Schedule Classes</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/jobs.html#using-the-cron-service" class="sidebar-link">Using the Cron Service</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/jobs.html#automatic-logs" class="sidebar-link">Automatic Logs</a></li></ul></li><li><a href="/docs/advanced/testing.html" class="sidebar-link">Testing</a></li><li><a href="/docs/advanced/requests.html" class="sidebar-link">The Requests Service</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Databases</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Included Plugins</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="jobs"><a href="#jobs" aria-hidden="true" class="header-anchor">#</a> Jobs</h1><p>The Cron Service maintains a library of singleton Jobs that can be set up to
run according to a certain schedule. The Cron Service is not something you
should need to access directly in your application and it is configured by the
file <code>config/cron.js</code>.</p><p></p><div class="table-of-contents"><ul><li><a href="#activating-the-cron-service">Activating the Cron Service</a></li><li><a href="#job-classes">Job Classes</a></li><li><a href="#schedule-classes">Schedule Classes</a></li><li><a href="#using-the-cron-service">Using the Cron Service</a><ul><li><a href="#invoking-terminal-commands">Invoking Terminal Commands</a></li><li><a href="#cron-configuration">Cron Configuration</a></li><li><a href="#scheduling-options">Scheduling Options</a></li></ul></li><li><a href="#automatic-logs">Automatic Logs</a></li></ul></div><p></p><h2 id="activating-the-cron-service"><a href="#activating-the-cron-service" aria-hidden="true" class="header-anchor">#</a> Activating the Cron Service</h2><p>To turn the Cron Service on (so that it actually schedules Jobs), the
<code>isActive</code> property of <code>config/cron.js</code> needs to be set to <code>true</code>. This makes
it easy to toggle the Service's functionality. The other property in
<code>config/cron.js</code> is <code>schedule</code>, which is a list of configurations for
when recurring Jobs should be run. Details for this are described below.</p><h2 id="job-classes"><a href="#job-classes" aria-hidden="true" class="header-anchor">#</a> Job Classes</h2><p>Job classes define a certain action.</p><p>You can generate a new Job class using the CLI:</p><div class="language- extra-class"><pre class="language-text"><code>node . generate job MyCustomJob
</code></pre></div><p>This would create the file
<code>site/cron/jobs/my-custom-job.js</code>.</p><p>A Job class should look like this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyCustomJob</span> <span class="token keyword">extends</span> <span class="token class-name">BaseJob</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// do stuff</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> <span class="token string">&quot;This is some information.&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyCustomJob<span class="token punctuation">;</span>
</code></pre></div><p>You can do what you want to in the <code>handle</code> method. The <code>args</code> object will be
provided in your configuration for the Cron Service. The <code>handle</code> method must
return an object with both the properties <code>success</code> (a boolean) and <code>message</code>
(a string). Results will be logged using the Logger Service with &quot;Cron&quot; as the
source and the returned message as the log message. If the <code>success</code> value
of the return object is <code>false</code>, the log will be at ERROR level. If <code>true</code>,
the log will be at VERBOSE level.</p><h2 id="schedule-classes"><a href="#schedule-classes" aria-hidden="true" class="header-anchor">#</a> Schedule Classes</h2><p>Schedule classes are used to determine when Jobs should run, coupled with
configuration objects. You may not need to write your own</p><p>You can generate a new schedule using the CLI:</p><div class="language- extra-class"><pre class="language-text"><code>node . generate schedule my-custom-schedule
</code></pre></div><p>This would create the file
<code>site/cron/schedules/my-custom-schedule.js</code>.</p><p>There are two methods to define, <code>shouldRunOnStart</code> and <code>nextRunTime</code>.
Both are passed the current time and the configuration defined
for the scheduled job. The first should return true or false based on whether
the Job should run at the beginning of the server starting up. The second
method should return a <a href="https://www.npmjs.com/package/moment" target="_blank" rel="noopener noreferrer">moment<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
time object.</p><h2 id="using-the-cron-service"><a href="#using-the-cron-service" aria-hidden="true" class="header-anchor">#</a> Using the Cron Service</h2><p>The Cron Service is automatically started with the <code>runserver</code> command,
if <code>isActive</code> is set to <code>true</code> in <code>config/cron.js</code>. The first check will run
after 30 seconds, and every 30 seconds thereafter.</p><h3 id="invoking-terminal-commands"><a href="#invoking-terminal-commands" aria-hidden="true" class="header-anchor">#</a> Invoking Terminal Commands</h3><p>Often, you may want to invoke a Terminal Command from a Job. This is done
in the included Job <code>ClearTmpJob</code> which clears the <code>.tmp/</code> directory of all
files more than X number of hours old:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
  <span class="token keyword">let</span> TerminalSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'Terminal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ClearTmpCommand <span class="token operator">=</span> TerminalSvc<span class="token punctuation">.</span><span class="token function">_command</span><span class="token punctuation">(</span><span class="token string">'ClearTmpCommand'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// call the Command, passing in args</span>
  <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">await</span> ClearTmpCommand<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token punctuation">:</span> args<span class="token punctuation">.</span>hours <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Files in .tmp/ that were more than </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span>hours<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> hours old have been deleted.`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="cron-configuration"><a href="#cron-configuration" aria-hidden="true" class="header-anchor">#</a> Cron Configuration</h3><p>A Cron Service schedule is defined in <code>config/cron.js</code> and looks like this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// when to run jobs</span>
schedule<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">'clearTmpDaily'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    job<span class="token punctuation">:</span> <span class="token string">'ClearTmpJob'</span><span class="token punctuation">,</span>
    args<span class="token punctuation">:</span> <span class="token punctuation">{</span> hours<span class="token punctuation">:</span> <span class="token number">24</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    when<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      schedule<span class="token punctuation">:</span> <span class="token string">'MinuteSchedule'</span><span class="token punctuation">,</span>
      conf<span class="token punctuation">:</span> <span class="token punctuation">{</span> every<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>schedule</code> property is a map of custom Cron Job names to objects describing
the Job and Schedule. The <code>job</code> property references the Job to run.
The <code>args</code> property is the object that will be passed into the <code>handle</code>
method of the Job. The <code>when</code> property is an object. The <code>schedule</code> property
of <code>when</code> names the Schedule, and the <code>conf</code> property of <code>when</code> is the config
object that will be passed in the calls to methods of the Schedule. The above
configuration instructs the <code>ClearTmpJob</code> to run to delete all <code>.tmp/</code> files
older than 24 hours old every 5 minutes.</p><h3 id="scheduling-options"><a href="#scheduling-options" aria-hidden="true" class="header-anchor">#</a> Scheduling Options</h3><p>There are several included Schedules, and below are some common use cases
for them (all are example <code>when</code> objects).</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// run every minute</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'MinuteSchedule'</span> <span class="token punctuation">}</span>

<span class="token comment">// run every 5 minutes</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'MinuteSchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> every<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// run every 10 minutes</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'MinuteSchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> every<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// run every 30 minutes</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'MinuteSchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> every<span class="token punctuation">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// run every hour on the hour</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'HourSchedule'</span> <span class="token punctuation">}</span>

<span class="token comment">// run on the 20 minute mark of every hour</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'HourSchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> minute<span class="token punctuation">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// run every 3 hours on the 10 minute mark</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'HourSchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> every<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// run every day at midnight</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'DaySchedule'</span> <span class="token punctuation">}</span>

<span class="token comment">// run every day at 2:30 pm</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'DaySchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> hour<span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// run every week at midnight Sunday</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'WeekSchedule'</span> <span class="token punctuation">}</span>

<span class="token comment">// run every week on Tuesday at 8:20 am</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'WeekSchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> day<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> hour<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// run at midnight on the first day of every month</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'MonthSchedule'</span> <span class="token punctuation">}</span>

<span class="token comment">// run on 4th day of every month at 11:25 am</span>
when<span class="token punctuation">:</span> <span class="token punctuation">{</span> schedule<span class="token punctuation">:</span> <span class="token string">'MonthSchedule'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> day<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> hour<span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token number">25</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that all schedules are approximate. A thing to run every minute may
run as close as 30 seconds apart sometimes and up to 2 minutes apart.
Also note that if the application is started and then stopped for a while,
when it is started again any task that's next run has past will be started
within
the first minute.</p></div><h2 id="automatic-logs"><a href="#automatic-logs" aria-hidden="true" class="header-anchor">#</a> Automatic Logs</h2><p>After every Job is complete, the Cron Service creates a log entry using the
<a href="/docs/basics/logging.html">Logger Service</a>. The source of the log will be
&quot;CRON&quot; and the message will be the message returned by the Job. If the Job
was successful, the level will be VERBOSE, otherwise the level will be
ERROR.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/advanced/plugins.html" class="prev">
          Plugins
        </a></span><span class="next"><a href="/docs/advanced/testing.html">
          Testing
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.1d2d3735.js" defer></script><script src="/assets/js/7.24dcfe4e.js" defer></script>
  </body>
</html>
