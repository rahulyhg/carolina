<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Events | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.4c99cee3.css" as="style"><link rel="preload" href="/assets/js/app.4c99cee3.js" as="script"><link rel="preload" href="/assets/js/5.39ac8b79.js" as="script"><link rel="prefetch" href="/assets/js/1.1cf9f1db.js"><link rel="prefetch" href="/assets/js/10.67736b9c.js"><link rel="prefetch" href="/assets/js/11.7beeac27.js"><link rel="prefetch" href="/assets/js/12.8ffce904.js"><link rel="prefetch" href="/assets/js/13.54a86374.js"><link rel="prefetch" href="/assets/js/14.f6222131.js"><link rel="prefetch" href="/assets/js/15.60843f1a.js"><link rel="prefetch" href="/assets/js/16.3bab9827.js"><link rel="prefetch" href="/assets/js/17.371a0e2c.js"><link rel="prefetch" href="/assets/js/18.2bf4752f.js"><link rel="prefetch" href="/assets/js/19.d7b2b433.js"><link rel="prefetch" href="/assets/js/2.d296c8c8.js"><link rel="prefetch" href="/assets/js/20.84f7874a.js"><link rel="prefetch" href="/assets/js/21.b063a67b.js"><link rel="prefetch" href="/assets/js/22.75e8e46c.js"><link rel="prefetch" href="/assets/js/23.c3543ea8.js"><link rel="prefetch" href="/assets/js/24.5c5f18c8.js"><link rel="prefetch" href="/assets/js/25.64098a0b.js"><link rel="prefetch" href="/assets/js/26.e2acfd13.js"><link rel="prefetch" href="/assets/js/27.aff06937.js"><link rel="prefetch" href="/assets/js/28.8bc12e94.js"><link rel="prefetch" href="/assets/js/29.c7890b85.js"><link rel="prefetch" href="/assets/js/3.79b6242f.js"><link rel="prefetch" href="/assets/js/30.1c7523a4.js"><link rel="prefetch" href="/assets/js/31.41d153ce.js"><link rel="prefetch" href="/assets/js/32.076ea23e.js"><link rel="prefetch" href="/assets/js/33.4df50c49.js"><link rel="prefetch" href="/assets/js/34.afd39df7.js"><link rel="prefetch" href="/assets/js/35.96ad804d.js"><link rel="prefetch" href="/assets/js/36.4b18f55f.js"><link rel="prefetch" href="/assets/js/37.785cf241.js"><link rel="prefetch" href="/assets/js/38.8ff035ad.js"><link rel="prefetch" href="/assets/js/39.e0c013ee.js"><link rel="prefetch" href="/assets/js/4.455a7b47.js"><link rel="prefetch" href="/assets/js/40.141dd392.js"><link rel="prefetch" href="/assets/js/41.c0c4f533.js"><link rel="prefetch" href="/assets/js/42.a505c995.js"><link rel="prefetch" href="/assets/js/43.9538af71.js"><link rel="prefetch" href="/assets/js/44.4a09b0cb.js"><link rel="prefetch" href="/assets/js/45.01328d52.js"><link rel="prefetch" href="/assets/js/46.d54fdc6d.js"><link rel="prefetch" href="/assets/js/47.93af6532.js"><link rel="prefetch" href="/assets/js/48.3aecbfc9.js"><link rel="prefetch" href="/assets/js/49.030d249e.js"><link rel="prefetch" href="/assets/js/50.830dbfe7.js"><link rel="prefetch" href="/assets/js/51.8883ddf5.js"><link rel="prefetch" href="/assets/js/52.0e11daf2.js"><link rel="prefetch" href="/assets/js/53.fc4fea9f.js"><link rel="prefetch" href="/assets/js/54.224ab9d2.js"><link rel="prefetch" href="/assets/js/55.57f73974.js"><link rel="prefetch" href="/assets/js/56.f67ded59.js"><link rel="prefetch" href="/assets/js/6.53b715ea.js"><link rel="prefetch" href="/assets/js/7.3c48cb9f.js"><link rel="prefetch" href="/assets/js/8.23ab337a.js"><link rel="prefetch" href="/assets/js/9.01843353.js">
    <link rel="stylesheet" href="/assets/css/styles.4c99cee3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">Tutorial</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">Tutorial</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Getting Started</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Framework Overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Basics</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Advanced</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/docs/advanced/cli.html" class="sidebar-link">CLI</a></li><li><a href="/docs/advanced/events.html" class="active sidebar-link">Events</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/advanced/events.html#setup" class="sidebar-link">Setup</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/events.html#writing-events" class="sidebar-link">Writing Events</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/events.html#writing-listeners" class="sidebar-link">Writing Listeners</a></li></ul></li><li><a href="/docs/advanced/web-sockets.html" class="sidebar-link">Web Sockets</a></li><li><a href="/docs/advanced/files.html" class="sidebar-link">Working with Files</a></li><li><a href="/docs/advanced/email.html" class="sidebar-link">Email</a></li><li><a href="/docs/advanced/plugins.html" class="sidebar-link">Plugins</a></li><li><a href="/docs/advanced/jobs.html" class="sidebar-link">Jobs</a></li><li><a href="/docs/advanced/testing.html" class="sidebar-link">Testing</a></li><li><a href="/docs/advanced/requests.html" class="sidebar-link">The Requests Service</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Databases</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Included Plugins</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="events"><a href="#events" aria-hidden="true" class="header-anchor">#</a> Events</h1><p>The Events Service maintains libraries of Event classes and Listener
singletons. The Service also tracks which Listeners should listen for which
Event types, based on your configuration. Listeners react to Events when they
are fired anywhere in your application.</p><p>You can get a reference to the Events Service in order to access, contruct,
and fire Events (more details below):</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> EventsSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'Events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> CustomEvent <span class="token operator">=</span> EventsSvc<span class="token punctuation">.</span><span class="token function">_eventClass</span><span class="token punctuation">(</span><span class="token string">'CustomEvent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

event<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Events are good way to declare that something has taken place and to
encapsulate information about it, and then allow other code to run in response
to that event asynchronously so the request can still process quickly. It also
decouples the part of your code that reacts to certain events from the part of
the code that actually fires them.</p><p></p><div class="table-of-contents"><ul><li><a href="#setup">Setup</a><ul><li><a href="#generating-events">Generating Events</a></li><li><a href="#generating-listeners">Generating Listeners</a></li></ul></li><li><a href="#writing-events">Writing Events</a></li><li><a href="#writing-listeners">Writing Listeners</a></li></ul></div><p></p><h2 id="setup"><a href="#setup" aria-hidden="true" class="header-anchor">#</a> Setup</h2><p>The mapping of Listeners to certain Event types is done in the configuration
file <code>config/events.js</code> in the property <code>eventListeners</code>. For example, suppose
that you want to send an e-mail to someone after the user submits a form, but
you want to have the HTTP response return quickly and may want to be able to
later add other things that should happen in response to the form submission.</p><p>In that case, you may have defined an Event class called &quot;FormSubmittedEvent&quot;
and a Listener called &quot;EmailFormConfirmationListener&quot;. You might configure
the Events Service this way:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>eventListeners<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  EmailFormConfirmationListener<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">'FormSubmittedEvent'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This tells the Events Service that every time a <code>FormSubmittedEvent</code> is fired,
it should be handed to the <code>EmailFormConfirmationListener</code> instance for
further processing.</p><h3 id="generating-events"><a href="#generating-events" aria-hidden="true" class="header-anchor">#</a> Generating Events</h3><p>You can generate a new Event class using the CLI:</p><div class="language- extra-class"><pre class="language-text"><code>node . generate event CustomEvent
</code></pre></div><p>This would create the file
<code>site/events/events/custom-event.js</code>.</p><h3 id="generating-listeners"><a href="#generating-listeners" aria-hidden="true" class="header-anchor">#</a> Generating Listeners</h3><p>You can generate a Listener using the CLI:</p><div class="language- extra-class"><pre class="language-text"><code>node . generate listener CustomListener
</code></pre></div><p>This would create the file
<code>site/events/listeners/custom-listener.js</code>.</p><h2 id="writing-events"><a href="#writing-events" aria-hidden="true" class="header-anchor">#</a> Writing Events</h2><p>Events shouldn't do much more than encapsulate some information. The normal
way to do this is to take an object in the constructor and save some properties
to <code>this</code>.</p><p>Example Event:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">FormSubmissionEvent</span> <span class="token keyword">extends</span> <span class="token class-name">BaseEvent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">'FormSubmissionEvent'</span><span class="token punctuation">,</span> <span class="token string">&quot;A user has submitted a form.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>formFieldA <span class="token operator">=</span> user<span class="token punctuation">.</span>form<span class="token punctuation">.</span>fieldA<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>formFieldB <span class="token operator">=</span> user<span class="token punctuation">.</span>form<span class="token punctuation">.</span>fieldB<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FormSubmissionEvent<span class="token punctuation">;</span>
</code></pre></div><p>You would have to ensure that your Event is exported by
<code>site/events/events/index.js</code>:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// custom event classes</span>
exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  FormSubmissionEvent<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./form-submission-event'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The arguments to the super constructor are its name and description.
The description is arbitrary and is only used for logging purposes,
but the <em>name is important</em>. They are bound as <code>event.name</code> and
<code>event.description</code>.</p><div class="danger custom-block"><p class="custom-block-title">WARNING</p><p>The name passed to the <code>super</code> constructor MUST match the name of the
Event. It is used to map the Event instance to the appropriate Listener.</p></div><p>For clarity, you should document what type of object the Event expects to
be constructed with.</p><p>You could fire the event like this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> FormSubmissionEvent <span class="token operator">=</span> EventsSvc<span class="token punctuation">.</span><span class="token function">_eventClass</span><span class="token punctuation">(</span><span class="token string">'FormSubmissionEvent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormSubmissionEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> form<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

event<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="writing-listeners"><a href="#writing-listeners" aria-hidden="true" class="header-anchor">#</a> Writing Listeners</h2><p>Unlike Events, which are managed by the Events Service as a class library,
Listeners are singletons which are instantiated the first time they are needed.
They are instantiated with no arguments passed to the constructor.</p><p>When an Event with a name that a Listener is configured to listen for is
fired, the Events Service passes the Event object to the <code>handle</code> method
of that Listener and call it <em>without awaiting</em>. It does this for all
Listeners that should receive it.</p><p>A Listener's logic goes in the <code>handle</code> method.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">CustomListener</span> <span class="token keyword">extends</span> <span class="token class-name">BaseListener</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>formFieldA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do stuff with event</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CustomListener<span class="token punctuation">;</span>
</code></pre></div><p>You would need to export the Listener in
<code>site/events/listeners/index.js</code>:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// custom listeners</span>
exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  CustomListener<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./custom-listener'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/advanced/cli.html" class="prev">
          CLI
        </a></span><span class="next"><a href="/docs/advanced/web-sockets.html">
          Web Sockets
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.4c99cee3.js" defer></script><script src="/assets/js/5.39ac8b79.js" defer></script>
  </body>
</html>
