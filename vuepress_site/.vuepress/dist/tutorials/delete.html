<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deleting Items | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.4c99cee3.css" as="style"><link rel="preload" href="/assets/js/app.4c99cee3.js" as="script"><link rel="preload" href="/assets/js/50.830dbfe7.js" as="script"><link rel="prefetch" href="/assets/js/1.1cf9f1db.js"><link rel="prefetch" href="/assets/js/10.67736b9c.js"><link rel="prefetch" href="/assets/js/11.7beeac27.js"><link rel="prefetch" href="/assets/js/12.8ffce904.js"><link rel="prefetch" href="/assets/js/13.54a86374.js"><link rel="prefetch" href="/assets/js/14.f6222131.js"><link rel="prefetch" href="/assets/js/15.60843f1a.js"><link rel="prefetch" href="/assets/js/16.3bab9827.js"><link rel="prefetch" href="/assets/js/17.371a0e2c.js"><link rel="prefetch" href="/assets/js/18.2bf4752f.js"><link rel="prefetch" href="/assets/js/19.d7b2b433.js"><link rel="prefetch" href="/assets/js/2.d296c8c8.js"><link rel="prefetch" href="/assets/js/20.84f7874a.js"><link rel="prefetch" href="/assets/js/21.b063a67b.js"><link rel="prefetch" href="/assets/js/22.75e8e46c.js"><link rel="prefetch" href="/assets/js/23.c3543ea8.js"><link rel="prefetch" href="/assets/js/24.5c5f18c8.js"><link rel="prefetch" href="/assets/js/25.64098a0b.js"><link rel="prefetch" href="/assets/js/26.e2acfd13.js"><link rel="prefetch" href="/assets/js/27.aff06937.js"><link rel="prefetch" href="/assets/js/28.8bc12e94.js"><link rel="prefetch" href="/assets/js/29.c7890b85.js"><link rel="prefetch" href="/assets/js/3.79b6242f.js"><link rel="prefetch" href="/assets/js/30.1c7523a4.js"><link rel="prefetch" href="/assets/js/31.41d153ce.js"><link rel="prefetch" href="/assets/js/32.076ea23e.js"><link rel="prefetch" href="/assets/js/33.4df50c49.js"><link rel="prefetch" href="/assets/js/34.afd39df7.js"><link rel="prefetch" href="/assets/js/35.96ad804d.js"><link rel="prefetch" href="/assets/js/36.4b18f55f.js"><link rel="prefetch" href="/assets/js/37.785cf241.js"><link rel="prefetch" href="/assets/js/38.8ff035ad.js"><link rel="prefetch" href="/assets/js/39.e0c013ee.js"><link rel="prefetch" href="/assets/js/4.455a7b47.js"><link rel="prefetch" href="/assets/js/40.141dd392.js"><link rel="prefetch" href="/assets/js/41.c0c4f533.js"><link rel="prefetch" href="/assets/js/42.a505c995.js"><link rel="prefetch" href="/assets/js/43.9538af71.js"><link rel="prefetch" href="/assets/js/44.4a09b0cb.js"><link rel="prefetch" href="/assets/js/45.01328d52.js"><link rel="prefetch" href="/assets/js/46.d54fdc6d.js"><link rel="prefetch" href="/assets/js/47.93af6532.js"><link rel="prefetch" href="/assets/js/48.3aecbfc9.js"><link rel="prefetch" href="/assets/js/49.030d249e.js"><link rel="prefetch" href="/assets/js/5.39ac8b79.js"><link rel="prefetch" href="/assets/js/51.8883ddf5.js"><link rel="prefetch" href="/assets/js/52.0e11daf2.js"><link rel="prefetch" href="/assets/js/53.fc4fea9f.js"><link rel="prefetch" href="/assets/js/54.224ab9d2.js"><link rel="prefetch" href="/assets/js/55.57f73974.js"><link rel="prefetch" href="/assets/js/56.f67ded59.js"><link rel="prefetch" href="/assets/js/6.53b715ea.js"><link rel="prefetch" href="/assets/js/7.3c48cb9f.js"><link rel="prefetch" href="/assets/js/8.23ab337a.js"><link rel="prefetch" href="/assets/js/9.01843353.js">
    <link rel="stylesheet" href="/assets/css/styles.4c99cee3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav><ul class="sidebar-links"><li><a href="/tutorials/" class="sidebar-link">Tutorial Introduction</a></li><li><a href="/tutorials/setup.html" class="sidebar-link">Setup</a></li><li><a href="/tutorials/db.html" class="sidebar-link">Database &amp; Models</a></li><li><a href="/tutorials/auth.html" class="sidebar-link">Auth Plugin Familiarization</a></li><li><a href="/tutorials/controller.html" class="sidebar-link">The Item Controller</a></li><li><a href="/tutorials/guarding.html" class="sidebar-link">Guarding the Routes</a></li><li><a href="/tutorials/templates.html" class="sidebar-link">Templates</a></li><li><a href="/tutorials/validation.html" class="sidebar-link">Validating Input</a></li><li><a href="/tutorials/creating-item.html" class="sidebar-link">Creating Item</a></li><li><a href="/tutorials/display.html" class="sidebar-link">Displaying Tasks</a></li><li><a href="/tutorials/delete.html" class="active sidebar-link">Deleting Items</a></li></ul></div><div class="page"><div class="content"><h1 id="deleting-items"><a href="#deleting-items" aria-hidden="true" class="header-anchor">#</a> Deleting Items</h1><p>It's time to fill in the DELETE button for each item in the inventory.
We will create tiny forms with delete buttons for each row. Edit the
iteration loop to look like this:</p><div class="language-pug extra-class"><pre class="language-pug"><code>                <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> item <span class="token keyword">in</span></span> locals<span class="token punctuation">.</span>items</span>
                  <span class="token tag">tr</span>
                    <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> item<span class="token punctuation">.</span>name</span>
                    <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> item<span class="token punctuation">.</span>description</span>
                    <span class="token tag">td</span>
                      <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span>
                        <span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;/items/delete/&quot;</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>_id</span>
                        <span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;POST&quot;</span></span>
                      <span class="token punctuation">)</span></span></span>
                        
                        <span class="token mixin"><span class="token name function">+csrfToken</span><span class="token punctuation">(</span>locals<span class="token punctuation">.</span>request<span class="token punctuation">)</span></span>
                        
                        <span class="token tag">button.btn.btn-danger</span> <span class="token plain-text">DELETE ITEM</span>
</code></pre></div><p>If you start the server and visit the page, you will see red delete buttons.
If you click one, you will be taken to the page with the simple &quot;Delete item&quot;
text. It's time to define that handler's correct behavior.</p><p>In <code>site/http/controllers/item-controller.js</code>,
write the <code>deleteItem</code> method to look like this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token function">deleteItem</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// get the Item class</span>
  <span class="token keyword">const</span> Item <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'DB'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_modelClass</span><span class="token punctuation">(</span><span class="token string">'Item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// get the specific item by id</span>
  <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token keyword">await</span> Item<span class="token punctuation">.</span><span class="token function">$lookup</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// check that the user actually owns the item</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>user <span class="token operator">!=</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token string">&quot;Something went wrong.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Uh-oh!&quot;</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">await</span> item<span class="token punctuation">.</span><span class="token function">_delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token string">&quot;Item deleted.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'primary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Restart the server and visit the page and try to delete an item. You should
be redirected and the item you deleted will be gone.</p><p>We're done.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/tutorials/display.html" class="prev">
          Displaying Tasks
        </a></span><!----></p></div></div></div></div>
    <script src="/assets/js/app.4c99cee3.js" defer></script><script src="/assets/js/50.830dbfe7.js" defer></script>
  </body>
</html>
