<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guarding the Routes | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.4c99cee3.css" as="style"><link rel="preload" href="/assets/js/app.4c99cee3.js" as="script"><link rel="preload" href="/assets/js/52.0e11daf2.js" as="script"><link rel="prefetch" href="/assets/js/1.1cf9f1db.js"><link rel="prefetch" href="/assets/js/10.67736b9c.js"><link rel="prefetch" href="/assets/js/11.7beeac27.js"><link rel="prefetch" href="/assets/js/12.8ffce904.js"><link rel="prefetch" href="/assets/js/13.54a86374.js"><link rel="prefetch" href="/assets/js/14.f6222131.js"><link rel="prefetch" href="/assets/js/15.60843f1a.js"><link rel="prefetch" href="/assets/js/16.3bab9827.js"><link rel="prefetch" href="/assets/js/17.371a0e2c.js"><link rel="prefetch" href="/assets/js/18.2bf4752f.js"><link rel="prefetch" href="/assets/js/19.d7b2b433.js"><link rel="prefetch" href="/assets/js/2.d296c8c8.js"><link rel="prefetch" href="/assets/js/20.84f7874a.js"><link rel="prefetch" href="/assets/js/21.b063a67b.js"><link rel="prefetch" href="/assets/js/22.75e8e46c.js"><link rel="prefetch" href="/assets/js/23.c3543ea8.js"><link rel="prefetch" href="/assets/js/24.5c5f18c8.js"><link rel="prefetch" href="/assets/js/25.64098a0b.js"><link rel="prefetch" href="/assets/js/26.e2acfd13.js"><link rel="prefetch" href="/assets/js/27.aff06937.js"><link rel="prefetch" href="/assets/js/28.8bc12e94.js"><link rel="prefetch" href="/assets/js/29.c7890b85.js"><link rel="prefetch" href="/assets/js/3.79b6242f.js"><link rel="prefetch" href="/assets/js/30.1c7523a4.js"><link rel="prefetch" href="/assets/js/31.41d153ce.js"><link rel="prefetch" href="/assets/js/32.076ea23e.js"><link rel="prefetch" href="/assets/js/33.4df50c49.js"><link rel="prefetch" href="/assets/js/34.afd39df7.js"><link rel="prefetch" href="/assets/js/35.96ad804d.js"><link rel="prefetch" href="/assets/js/36.4b18f55f.js"><link rel="prefetch" href="/assets/js/37.785cf241.js"><link rel="prefetch" href="/assets/js/38.8ff035ad.js"><link rel="prefetch" href="/assets/js/39.e0c013ee.js"><link rel="prefetch" href="/assets/js/4.455a7b47.js"><link rel="prefetch" href="/assets/js/40.141dd392.js"><link rel="prefetch" href="/assets/js/41.c0c4f533.js"><link rel="prefetch" href="/assets/js/42.a505c995.js"><link rel="prefetch" href="/assets/js/43.9538af71.js"><link rel="prefetch" href="/assets/js/44.4a09b0cb.js"><link rel="prefetch" href="/assets/js/45.01328d52.js"><link rel="prefetch" href="/assets/js/46.d54fdc6d.js"><link rel="prefetch" href="/assets/js/47.93af6532.js"><link rel="prefetch" href="/assets/js/48.3aecbfc9.js"><link rel="prefetch" href="/assets/js/49.030d249e.js"><link rel="prefetch" href="/assets/js/5.39ac8b79.js"><link rel="prefetch" href="/assets/js/50.830dbfe7.js"><link rel="prefetch" href="/assets/js/51.8883ddf5.js"><link rel="prefetch" href="/assets/js/53.fc4fea9f.js"><link rel="prefetch" href="/assets/js/54.224ab9d2.js"><link rel="prefetch" href="/assets/js/55.57f73974.js"><link rel="prefetch" href="/assets/js/56.f67ded59.js"><link rel="prefetch" href="/assets/js/6.53b715ea.js"><link rel="prefetch" href="/assets/js/7.3c48cb9f.js"><link rel="prefetch" href="/assets/js/8.23ab337a.js"><link rel="prefetch" href="/assets/js/9.01843353.js">
    <link rel="stylesheet" href="/assets/css/styles.4c99cee3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav><ul class="sidebar-links"><li><a href="/tutorials/" class="sidebar-link">Tutorial Introduction</a></li><li><a href="/tutorials/setup.html" class="sidebar-link">Setup</a></li><li><a href="/tutorials/db.html" class="sidebar-link">Database &amp; Models</a></li><li><a href="/tutorials/auth.html" class="sidebar-link">Auth Plugin Familiarization</a></li><li><a href="/tutorials/controller.html" class="sidebar-link">The Item Controller</a></li><li><a href="/tutorials/guarding.html" class="active sidebar-link">Guarding the Routes</a></li><li><a href="/tutorials/templates.html" class="sidebar-link">Templates</a></li><li><a href="/tutorials/validation.html" class="sidebar-link">Validating Input</a></li><li><a href="/tutorials/creating-item.html" class="sidebar-link">Creating Item</a></li><li><a href="/tutorials/display.html" class="sidebar-link">Displaying Tasks</a></li><li><a href="/tutorials/delete.html" class="sidebar-link">Deleting Items</a></li></ul></div><div class="page"><div class="content"><h1 id="guarding-the-routes"><a href="#guarding-the-routes" aria-hidden="true" class="header-anchor">#</a> Guarding the Routes</h1><p>We need to apply an authentication guard to all the routes we just defined,
since we only want logged-in users to be able to access them. We could
specify middleware in the route configuration, but since we want the
auth guard to apply to all handlers of the Controller class, we can do it
there.</p><p>In <code>site/http/controllers/item-controller.js</code>, below the constructor but above
the handler methods, create the method <code>getMiddleware</code>:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">getMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'Carolina/Auth/AuthGuardMiddleware'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The named Middleware class is provided by the Carolina Auth plugin, and
protects all routes handled by this Controller class for access by users
who are not logged in. Let's try it.</p><p>Run the server using <code>node . runserver</code> and visit the homepage of the running
application. Then try to visit <code>http://localhost:8080/items</code>. You will be
redirected to the login page.</p><p>We haven't created any accounts yet and registration should be open by default,
so click the &quot;Register&quot; link at the top right and create some account.</p><p>Once you create the account you should be able to immediately login since
requiring e-mail verification is disabled by default. Once you login, you
will be redirect to &quot;/home&quot;, which we haven't defined a controller for.</p><p>We don't want users redirect to &quot;/home&quot;. Open the config file for the auth
plugin, <code>config/carolina_auth.js</code>. Look for the value <code>loginRedirect</code>, which
is set to &quot;/home&quot; by default and change it to say &quot;/items&quot;.</p><p>Restart the server and go to <code>http://localhost:8080/auth/login</code>
and you will be redirected to
<code>/items</code>.</p><p>Go to <code>http://localhost:8080/auth/logout</code> and click the logout button.
Then try going to <code>http://localhost:8080/items</code> and you should be blocked
and sent to the login page again. The Auth Guard is now working!</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/tutorials/controller.html" class="prev">
          The Item Controller
        </a></span><span class="next"><a href="/tutorials/templates.html">
          Templates
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.4c99cee3.js" defer></script><script src="/assets/js/52.0e11daf2.js" defer></script>
  </body>
</html>
