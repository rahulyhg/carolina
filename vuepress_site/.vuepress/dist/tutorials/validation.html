<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validating Input | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.4c99cee3.css" as="style"><link rel="preload" href="/assets/js/app.4c99cee3.js" as="script"><link rel="preload" href="/assets/js/56.f67ded59.js" as="script"><link rel="prefetch" href="/assets/js/1.1cf9f1db.js"><link rel="prefetch" href="/assets/js/10.67736b9c.js"><link rel="prefetch" href="/assets/js/11.7beeac27.js"><link rel="prefetch" href="/assets/js/12.8ffce904.js"><link rel="prefetch" href="/assets/js/13.54a86374.js"><link rel="prefetch" href="/assets/js/14.f6222131.js"><link rel="prefetch" href="/assets/js/15.60843f1a.js"><link rel="prefetch" href="/assets/js/16.3bab9827.js"><link rel="prefetch" href="/assets/js/17.371a0e2c.js"><link rel="prefetch" href="/assets/js/18.2bf4752f.js"><link rel="prefetch" href="/assets/js/19.d7b2b433.js"><link rel="prefetch" href="/assets/js/2.d296c8c8.js"><link rel="prefetch" href="/assets/js/20.84f7874a.js"><link rel="prefetch" href="/assets/js/21.b063a67b.js"><link rel="prefetch" href="/assets/js/22.75e8e46c.js"><link rel="prefetch" href="/assets/js/23.c3543ea8.js"><link rel="prefetch" href="/assets/js/24.5c5f18c8.js"><link rel="prefetch" href="/assets/js/25.64098a0b.js"><link rel="prefetch" href="/assets/js/26.e2acfd13.js"><link rel="prefetch" href="/assets/js/27.aff06937.js"><link rel="prefetch" href="/assets/js/28.8bc12e94.js"><link rel="prefetch" href="/assets/js/29.c7890b85.js"><link rel="prefetch" href="/assets/js/3.79b6242f.js"><link rel="prefetch" href="/assets/js/30.1c7523a4.js"><link rel="prefetch" href="/assets/js/31.41d153ce.js"><link rel="prefetch" href="/assets/js/32.076ea23e.js"><link rel="prefetch" href="/assets/js/33.4df50c49.js"><link rel="prefetch" href="/assets/js/34.afd39df7.js"><link rel="prefetch" href="/assets/js/35.96ad804d.js"><link rel="prefetch" href="/assets/js/36.4b18f55f.js"><link rel="prefetch" href="/assets/js/37.785cf241.js"><link rel="prefetch" href="/assets/js/38.8ff035ad.js"><link rel="prefetch" href="/assets/js/39.e0c013ee.js"><link rel="prefetch" href="/assets/js/4.455a7b47.js"><link rel="prefetch" href="/assets/js/40.141dd392.js"><link rel="prefetch" href="/assets/js/41.c0c4f533.js"><link rel="prefetch" href="/assets/js/42.a505c995.js"><link rel="prefetch" href="/assets/js/43.9538af71.js"><link rel="prefetch" href="/assets/js/44.4a09b0cb.js"><link rel="prefetch" href="/assets/js/45.01328d52.js"><link rel="prefetch" href="/assets/js/46.d54fdc6d.js"><link rel="prefetch" href="/assets/js/47.93af6532.js"><link rel="prefetch" href="/assets/js/48.3aecbfc9.js"><link rel="prefetch" href="/assets/js/49.030d249e.js"><link rel="prefetch" href="/assets/js/5.39ac8b79.js"><link rel="prefetch" href="/assets/js/50.830dbfe7.js"><link rel="prefetch" href="/assets/js/51.8883ddf5.js"><link rel="prefetch" href="/assets/js/52.0e11daf2.js"><link rel="prefetch" href="/assets/js/53.fc4fea9f.js"><link rel="prefetch" href="/assets/js/54.224ab9d2.js"><link rel="prefetch" href="/assets/js/55.57f73974.js"><link rel="prefetch" href="/assets/js/6.53b715ea.js"><link rel="prefetch" href="/assets/js/7.3c48cb9f.js"><link rel="prefetch" href="/assets/js/8.23ab337a.js"><link rel="prefetch" href="/assets/js/9.01843353.js">
    <link rel="stylesheet" href="/assets/css/styles.4c99cee3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav><ul class="sidebar-links"><li><a href="/tutorials/" class="sidebar-link">Tutorial Introduction</a></li><li><a href="/tutorials/setup.html" class="sidebar-link">Setup</a></li><li><a href="/tutorials/db.html" class="sidebar-link">Database &amp; Models</a></li><li><a href="/tutorials/auth.html" class="sidebar-link">Auth Plugin Familiarization</a></li><li><a href="/tutorials/controller.html" class="sidebar-link">The Item Controller</a></li><li><a href="/tutorials/guarding.html" class="sidebar-link">Guarding the Routes</a></li><li><a href="/tutorials/templates.html" class="sidebar-link">Templates</a></li><li><a href="/tutorials/validation.html" class="active sidebar-link">Validating Input</a></li><li><a href="/tutorials/creating-item.html" class="sidebar-link">Creating Item</a></li><li><a href="/tutorials/display.html" class="sidebar-link">Displaying Tasks</a></li><li><a href="/tutorials/delete.html" class="sidebar-link">Deleting Items</a></li></ul></div><div class="page"><div class="content"><h1 id="validating-input"><a href="#validating-input" aria-hidden="true" class="header-anchor">#</a> Validating Input</h1><p>The Validation Service is one of the included Carolina Services, and it handles
validating that given objects comply with specific schemas. Before working
with the Validation Service in the Controller class, let's create a schema
representing the data we expect from user input.</p><p>You can create a new Validation Schema class using the CLI:</p><div class="language- extra-class"><pre class="language-text"><code>node . generate validation-schema NewItemSchema
</code></pre></div><p>The above command will create the file
<code>site/validation/schemas/new-item-schema.js</code>. Validation Schemas are just like
Schema classes for Database models, except that they are not attached to any
Models. Make the new Schema look like this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> BaseSchema <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'carolina/main/db/schemas/base-schema'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">NewItemSchema</span> <span class="token keyword">extends</span> <span class="token class-name">BaseSchema</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// no auto date fields</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span>item <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'String'</span><span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'String'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> NewItemSchema<span class="token punctuation">;</span>
</code></pre></div><p>Notice that <code>false</code> is passed to the super constructor. This tells the
super constructor that this Schema is designed for use with a Database
Model class and should not have the auto date fields assigned. Note that
the <code>item</code> field is also marked as required. The fields of the Schema match
the fields in the HTML form that was created in the last section.</p><p>Ensure that this Schema is exported by the file
<code>site/validation/schemas/index.js</code> like this:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  NewItemSchema<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./new-item-schema'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This registers the Schema class with the Validation Service.
In any part of the application, you can access the Validation Service from
the global Carolina object:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> ValidationSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'Validation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The Validation Service allows you to compare certain objects to defined Schema
classes, which we will do shortly. For more information about the Validation
Service, see the documentation on <a href="/docs/basics/validation.html">validation</a>.</p><p>The Base Controller class defines a <code>_validate()</code> method which provides
a shortcut to the Validation Service. Let's use that in the Controller method
that handles POST requests for the &quot;New Item&quot; form:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token function">createItem</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_validate</span><span class="token punctuation">(</span><span class="token string">'NewItemSchema'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendText</span><span class="token punctuation">(</span><span class="token string">&quot;Validation success.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">flash</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`Error in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token punctuation">.</span>field<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:`</span></span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>_validate</code> method takes 3 arguments: the name of a Schema registered with
the Validation Service, an object to validate, and a boolean value specifying
whether or not a &quot;ValidationError&quot; should be thrown on validation failure.</p><p>This method now tries to validate the incoming data from the New Item Form.
If validation succeeds, a success message is sent. Otherwise, an error
is &quot;flashed&quot; to the session. This &quot;flashing&quot; was the purpose of including
the <code>flashMessages</code> mixin in the pug template.</p><p>Run the server again and visit <code>http://localhost:8080/items</code> and try to
submit the form without putting anything in the &quot;Item Name&quot; input. You
will see the flash message after being redirected back. Input an item name
and submit again and you should see the text &quot;Validation success&quot;.</p><p>The behavior upon validation failure is exactly what is needed, but
when validation succeeds, we want to actually create the new item.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/tutorials/templates.html" class="prev">
          Templates
        </a></span><span class="next"><a href="/tutorials/creating-item.html">
          Creating Item
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.4c99cee3.js" defer></script><script src="/assets/js/56.f67ded59.js" defer></script>
  </body>
</html>
