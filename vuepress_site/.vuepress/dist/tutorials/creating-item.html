<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating Item | Carolina Documentation</title>
    <meta name="description" content="Documentation for the Carolina web framework.">
    
    
    <link rel="preload" href="/assets/css/styles.4c99cee3.css" as="style"><link rel="preload" href="/assets/js/app.4c99cee3.js" as="script"><link rel="preload" href="/assets/js/48.3aecbfc9.js" as="script"><link rel="prefetch" href="/assets/js/1.1cf9f1db.js"><link rel="prefetch" href="/assets/js/10.67736b9c.js"><link rel="prefetch" href="/assets/js/11.7beeac27.js"><link rel="prefetch" href="/assets/js/12.8ffce904.js"><link rel="prefetch" href="/assets/js/13.54a86374.js"><link rel="prefetch" href="/assets/js/14.f6222131.js"><link rel="prefetch" href="/assets/js/15.60843f1a.js"><link rel="prefetch" href="/assets/js/16.3bab9827.js"><link rel="prefetch" href="/assets/js/17.371a0e2c.js"><link rel="prefetch" href="/assets/js/18.2bf4752f.js"><link rel="prefetch" href="/assets/js/19.d7b2b433.js"><link rel="prefetch" href="/assets/js/2.d296c8c8.js"><link rel="prefetch" href="/assets/js/20.84f7874a.js"><link rel="prefetch" href="/assets/js/21.b063a67b.js"><link rel="prefetch" href="/assets/js/22.75e8e46c.js"><link rel="prefetch" href="/assets/js/23.c3543ea8.js"><link rel="prefetch" href="/assets/js/24.5c5f18c8.js"><link rel="prefetch" href="/assets/js/25.64098a0b.js"><link rel="prefetch" href="/assets/js/26.e2acfd13.js"><link rel="prefetch" href="/assets/js/27.aff06937.js"><link rel="prefetch" href="/assets/js/28.8bc12e94.js"><link rel="prefetch" href="/assets/js/29.c7890b85.js"><link rel="prefetch" href="/assets/js/3.79b6242f.js"><link rel="prefetch" href="/assets/js/30.1c7523a4.js"><link rel="prefetch" href="/assets/js/31.41d153ce.js"><link rel="prefetch" href="/assets/js/32.076ea23e.js"><link rel="prefetch" href="/assets/js/33.4df50c49.js"><link rel="prefetch" href="/assets/js/34.afd39df7.js"><link rel="prefetch" href="/assets/js/35.96ad804d.js"><link rel="prefetch" href="/assets/js/36.4b18f55f.js"><link rel="prefetch" href="/assets/js/37.785cf241.js"><link rel="prefetch" href="/assets/js/38.8ff035ad.js"><link rel="prefetch" href="/assets/js/39.e0c013ee.js"><link rel="prefetch" href="/assets/js/4.455a7b47.js"><link rel="prefetch" href="/assets/js/40.141dd392.js"><link rel="prefetch" href="/assets/js/41.c0c4f533.js"><link rel="prefetch" href="/assets/js/42.a505c995.js"><link rel="prefetch" href="/assets/js/43.9538af71.js"><link rel="prefetch" href="/assets/js/44.4a09b0cb.js"><link rel="prefetch" href="/assets/js/45.01328d52.js"><link rel="prefetch" href="/assets/js/46.d54fdc6d.js"><link rel="prefetch" href="/assets/js/47.93af6532.js"><link rel="prefetch" href="/assets/js/49.030d249e.js"><link rel="prefetch" href="/assets/js/5.39ac8b79.js"><link rel="prefetch" href="/assets/js/50.830dbfe7.js"><link rel="prefetch" href="/assets/js/51.8883ddf5.js"><link rel="prefetch" href="/assets/js/52.0e11daf2.js"><link rel="prefetch" href="/assets/js/53.fc4fea9f.js"><link rel="prefetch" href="/assets/js/54.224ab9d2.js"><link rel="prefetch" href="/assets/js/55.57f73974.js"><link rel="prefetch" href="/assets/js/56.f67ded59.js"><link rel="prefetch" href="/assets/js/6.53b715ea.js"><link rel="prefetch" href="/assets/js/7.3c48cb9f.js"><link rel="prefetch" href="/assets/js/8.23ab337a.js"><link rel="prefetch" href="/assets/js/9.01843353.js">
    <link rel="stylesheet" href="/assets/css/styles.4c99cee3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Carolina Documentation
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link router-link-active">Tutorial</a></div><!----></nav><ul class="sidebar-links"><li><a href="/tutorials/" class="sidebar-link">Tutorial Introduction</a></li><li><a href="/tutorials/setup.html" class="sidebar-link">Setup</a></li><li><a href="/tutorials/db.html" class="sidebar-link">Database &amp; Models</a></li><li><a href="/tutorials/auth.html" class="sidebar-link">Auth Plugin Familiarization</a></li><li><a href="/tutorials/controller.html" class="sidebar-link">The Item Controller</a></li><li><a href="/tutorials/guarding.html" class="sidebar-link">Guarding the Routes</a></li><li><a href="/tutorials/templates.html" class="sidebar-link">Templates</a></li><li><a href="/tutorials/validation.html" class="sidebar-link">Validating Input</a></li><li><a href="/tutorials/creating-item.html" class="active sidebar-link">Creating Item</a></li><li><a href="/tutorials/display.html" class="sidebar-link">Displaying Tasks</a></li><li><a href="/tutorials/delete.html" class="sidebar-link">Deleting Items</a></li></ul></div><div class="page"><div class="content"><h1 id="creating-item"><a href="#creating-item" aria-hidden="true" class="header-anchor">#</a> Creating Item</h1><p>It's time to create an actual Item when the user submits a POST request to
&quot;/item&quot; and form validation succeeds. First, there are a few things
worth covering. Take a look at the configuration for the Http Service, which
is found in the file <code>config/http.js</code>.</p><p>In the property <code>middleware_groups</code>, the browser group contains a list of
middleware including &quot;Carolina/Auth/ExtractUserMiddleware&quot;. This Middleware
class is provided by the Carolina Auth plugin and it automatically checks
incoming requests for session cookies that contain logged-in users. If
a user is logged in, the corresponding instance of the User model is attached
to the incoming Request object as <code>request.user</code>. We will take advantage of this
now.</p><p>Let's edit the if statement block that executes when validation succeeds in
the <code>createItem</code> method of <code>ItemController</code> in
<code>site/http/controllers/item-controller.js</code>:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// get the Item class from the DB Service</span>
  <span class="token keyword">const</span> DBSvc <span class="token operator">=</span> Carolina<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'DB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> Item <span class="token operator">=</span> DBSvc<span class="token punctuation">.</span><span class="token function">_modelClass</span><span class="token punctuation">(</span><span class="token string">'Item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// create a new Item class instance</span>
  <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>item <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  item<span class="token punctuation">.</span>description <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>description<span class="token punctuation">;</span>
  <span class="token comment">// set the user to the user on the request</span>
  item<span class="token punctuation">.</span>user <span class="token operator">=</span> request<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
  
  <span class="token comment">// save the item to the database</span>
  <span class="token keyword">await</span> item<span class="token punctuation">.</span><span class="token function">_save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// redirect the user back to /items with a success message</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token string">&quot;New item created.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Great!&quot;</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A few things are happening here. First, we get a reference to the DB Service
from the Carolina object. Then we get a reference to the Item class from the
DB Service. These steps could be combined to one line:
<code>Carolina.$('DB')._modelClass('Item');</code>.</p><p>Then an instance of the Item class is created with the item name provided
in the form. Then the description is set from the form data and the user is
set from the request user. The object is than saved as a new record in the
database. The user is then redirected with a success message.</p><p>Run the server and go to <code>http://localhost:8080/items</code> and fill out the form.
You should be redirected back with a success message. Currently, the newly
created item is not being displayed anywhere. Stop the server
(which triggers the <code>JsonConnection</code> database to write its data to files)
and check the file <code>data/main/item.json</code>. You should see the database info
of the newly saved object.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/tutorials/validation.html" class="prev">
          Validating Input
        </a></span><span class="next"><a href="/tutorials/display.html">
          Displaying Tasks
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/app.4c99cee3.js" defer></script><script src="/assets/js/48.3aecbfc9.js" defer></script>
  </body>
</html>
